# Claude Session Export

## Session Information

- **Session ID**: `agent-ad72409d`
- **Export Mode**: Full Conversation
- **Total Messages**: 31 (10 user, 21 assistant)
- **First Message**: 12/1/2025, 2:40:10 PM
- **Last Message**: 12/1/2025, 2:45:51 PM
- **Project Path**: `/home/chris/dev/projects/codex/brain_explore`

---

## Conversation

### Assistant
> 12/1/2025, 2:40:10 PM

[
  {
    "type": "text",
    "text": "I'll create a comprehensive question templates service with research-backed templates from therapy and coaching literature."
  }
]

---

### Assistant
> 12/1/2025, 2:40:11 PM

[
  {
    "type": "tool_use",
    "id": "toolu_011Ef58KPr5EKd5YGZnmmzYN",
    "name": "Read",
    "input": {
      "file_path": "/home/chris/dev/projects/codex/brain_explore/ies-backend/src/ies_backend/schemas/question_engine.py"
    }
  }
]

---

### User
> 12/1/2025, 2:40:12 PM

[
  {
    "tool_use_id": "toolu_011Ef58KPr5EKd5YGZnmmzYN",
    "type": "tool_result",
    "content": "     1→\"\"\"Question Engine schemas for state detection and approach selection.\"\"\"\n     2→\n     3→from enum import Enum\n     4→from typing import Annotated\n     5→\n     6→from pydantic import BaseModel, Field\n     7→\n     8→\n     9→class UserState(str, Enum):\n    10→    \"\"\"Detected user cognitive/emotional state during session.\"\"\"\n    11→\n    12→    FLOWING = \"flowing\"           # Engaged, productive, good energy\n    13→    STUCK = \"stuck\"               # Looping, not making progress\n    14→    OVERWHELMED = \"overwhelmed\"   # Too much, need grounding\n    15→    EXPLORING = \"exploring\"       # Curious, branching out\n    16→    PROCESSING = \"processing\"     # Need time to digest\n    17→    UNCERTAIN = \"uncertain\"       # Unclear on direction/purpose\n    18→    EMOTIONAL = \"emotional\"       # Strong feelings present\n    19→    TIRED = \"tired\"               # Low energy, need gentle approach\n    20→\n    21→\n    22→class InquiryApproach(str, Enum):\n    23→    \"\"\"Question approach types from the resource library.\"\"\"\n    24→\n    25→    # MVP approaches (5 core)\n    26→    SOCRATIC = \"socratic\"                   # Clarifying assumptions, testing logic\n    27→    SOLUTION_FOCUSED = \"solution_focused\"   # Forward motion, small steps\n    28→    PHENOMENOLOGICAL = \"phenomenological\"   # Body-based, felt sense, focusing\n    29→    SYSTEMS = \"systems\"                     # Connections, patterns, emergence\n    30→    METACOGNITIVE = \"metacognitive\"         # Reflection on thinking process\n    31→\n    32→    # Extended approaches (for future)\n    33→    CBT = \"cbt\"                             # Cognitive restructuring, testing beliefs\n    34→    NARRATIVE = \"narrative\"                 # Story, meaning-making, identity\n    35→    STRATEGIC = \"strategic\"                 # Planning, decisions, trade-offs\n    36→    SOMATIC = \"somatic\"                     # Grounding, regulation, body awareness\n    37→    DESIGN = \"design\"                       # Reframing, prototyping, iteration\n    38→\n    39→\n    40→class StateSignal(BaseModel):\n    41→    \"\"\"Signals used to detect user state.\"\"\"\n    42→\n    43→    # Response patterns\n    44→    response_length: Annotated[str, Field(description=\"short | medium | long\")] | None = None\n    45→    response_speed: Annotated[str, Field(description=\"quick | normal | delayed\")] | None = None\n    46→    certainty_language: Annotated[int, Field(ge=1, le=10, description=\"1=uncertain, 10=confident\")] | None = None\n    47→\n    48→    # Energy indicators\n    49→    energy_words: list[str] = Field(default_factory=list, description=\"Words indicating energy level\")\n    50→    frustration_indicators: list[str] = Field(default_factory=list)\n    51→    engagement_indicators: list[str] = Field(default_factory=list)\n    52→\n    53→    # Content patterns\n    54→    repetition_detected: bool = False  # Saying similar things\n    55→    tangent_frequency: Annotated[str, Field(description=\"low | medium | high\")] | None = None\n    56→    abstraction_level: Annotated[str, Field(description=\"concrete | mixed | abstract\")] | None = None\n    57→\n    58→    # Explicit signals\n    59→    explicit_state: str | None = None  # User said \"I'm tired\" etc.\n    60→    capacity_reported: Annotated[int, Field(ge=1, le=10)] | None = None\n    61→\n    62→\n    63→class StateDetection(BaseModel):\n    64→    \"\"\"Result of state detection analysis.\"\"\"\n    65→\n    66→    primary_state: UserState\n    67→    confidence: Annotated[float, Field(ge=0, le=1)]\n    68→    secondary_states: list[UserState] = Field(default_factory=list)\n    69→    signals_observed: StateSignal = Field(default_factory=StateSignal)\n    70→    reasoning: str | None = None  # Why this state was detected\n    71→\n    72→\n    73→class ApproachSelection(BaseModel):\n    74→    \"\"\"Result of approach selection based on state and profile.\"\"\"\n    75→\n    76→    selected_approach: InquiryApproach\n    77→    confidence: Annotated[float, Field(ge=0, le=1)]\n    78→    reasoning: str\n    79→\n    80→    # Profile adaptations\n    81→    pacing: Annotated[str, Field(description=\"fast | moderate | slow\")]\n    82→    directness: Annotated[str, Field(description=\"direct | balanced | gentle\")]\n    83→    abstraction: Annotated[str, Field(description=\"concrete | mixed | abstract\")]\n    84→    structure: Annotated[str, Field(description=\"tight | moderate | loose\")]\n    85→\n    86→    # Alternatives if this doesn't land\n    87→    fallback_approaches: list[InquiryApproach] = Field(default_factory=list)\n    88→\n    89→\n    90→class QuestionTemplate(BaseModel):\n    91→    \"\"\"A question template for a specific approach.\"\"\"\n    92→\n    93→    approach: InquiryApproach\n    94→    category: str  # e.g., \"clarifying\", \"deepening\", \"challenging\", \"grounding\"\n    95→    template: str  # The question pattern with {placeholders}\n    96→    when_to_use: str  # Description of appropriate context\n    97→    source: str | None = None  # Book/resource this came from\n    98→\n    99→    # Profile adaptations\n   100→    directness_variants: dict[str, str] = Field(\n   101→        default_factory=dict,\n   102→        description=\"Alternative phrasings by directness level\"\n   103→    )\n   104→    pace_considerations: str | None = None\n   105→\n   106→\n   107→class QuestionBatch(BaseModel):\n   108→    \"\"\"A batch of generated questions for a given state/approach.\"\"\"\n   109→\n   110→    approach: InquiryApproach\n   111→    state: UserState\n   112→    questions: list[str]\n   113→    context: str  # What triggered this generation\n   114→    profile_adaptations_applied: list[str] = Field(default_factory=list)\n   115→\n   116→\n   117→# Selection rules mapping\n   118→STATE_TO_APPROACHES: dict[UserState, list[InquiryApproach]] = {\n   119→    UserState.FLOWING: [InquiryApproach.SOCRATIC, InquiryApproach.SYSTEMS],\n   120→    UserState.STUCK: [InquiryApproach.SOCRATIC, InquiryApproach.METACOGNITIVE],\n   121→    UserState.OVERWHELMED: [InquiryApproach.SOLUTION_FOCUSED, InquiryApproach.PHENOMENOLOGICAL],\n   122→    UserState.EXPLORING: [InquiryApproach.SYSTEMS, InquiryApproach.SOCRATIC],\n   123→    UserState.PROCESSING: [InquiryApproach.PHENOMENOLOGICAL, InquiryApproach.METACOGNITIVE],\n   124→    UserState.UNCERTAIN: [InquiryApproach.METACOGNITIVE, InquiryApproach.SOLUTION_FOCUSED],\n   125→    UserState.EMOTIONAL: [InquiryApproach.PHENOMENOLOGICAL, InquiryApproach.SOLUTION_FOCUSED],\n   126→    UserState.TIRED: [InquiryApproach.SOLUTION_FOCUSED, InquiryApproach.PHENOMENOLOGICAL],\n   127→}\n   128→\n   129→\n   130→# Approach descriptions for system prompts\n   131→APPROACH_DESCRIPTIONS: dict[InquiryApproach, str] = {\n   132→    InquiryApproach.SOCRATIC: \"\"\"Socratic inquiry uses clarifying questions to surface assumptions,\n   133→test logical consistency, and deepen understanding. Ask 'what do you mean by...',\n   134→'what would have to be true for...', 'how does X relate to Y'.\"\"\",\n   135→\n   136→    InquiryApproach.SOLUTION_FOCUSED: \"\"\"Solution-focused approach emphasizes forward motion\n   137→and small, concrete steps. Ask about exceptions (when things worked), scaling questions\n   138→(1-10 where are you?), and 'what's one small thing that would make a difference'.\"\"\",\n   139→\n   140→    InquiryApproach.PHENOMENOLOGICAL: \"\"\"Phenomenological/Focusing approach attends to\n   141→felt sense and body-based knowing. Ask 'what do you notice in your body when you say that?',\n   142→'can you stay with that feeling?', 'what word or image fits that sensation?'.\"\"\",\n   143→\n   144→    InquiryApproach.SYSTEMS: \"\"\"Systems thinking looks at connections, patterns, and emergence.\n   145→Ask about relationships between parts, feedback loops, unintended consequences,\n   146→and how changes in one area affect others.\"\"\",\n   147→\n   148→    InquiryApproach.METACOGNITIVE: \"\"\"Metacognitive inquiry reflects on the thinking process itself.\n   149→Ask 'how are you approaching this problem?', 'what assumptions are you making?',\n   150→'what would you tell someone else in this situation?'.\"\"\",\n   151→}\n   152→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"
  }
]

---

### Assistant
> 12/1/2025, 2:40:14 PM

[
  {
    "type": "text",
    "text": "Now I'll create the comprehensive question templates service with research-backed templates:"
  }
]

---

### Assistant
> 12/1/2025, 2:42:17 PM

[
  {
    "type": "tool_use",
    "id": "toolu_013T6KPD5r1mK8uruDvScHLs",
    "name": "Write",
    "input": {
      "file_path": "/home/chris/dev/projects/codex/brain_explore/ies-backend/src/ies_backend/services/question_templates_service.py",
      "content": "\"\"\"Question Templates Service for the Intelligent Exploration System.\n\nThis service provides research-backed question templates from therapy and coaching literature,\norganized by inquiry approach and adapted to user profile settings.\n\"\"\"\n\nfrom typing import Any\n\nfrom ies_backend.schemas.question_engine import (\n    InquiryApproach,\n    QuestionBatch,\n    QuestionTemplate,\n    UserState,\n)\n\n\nclass QuestionTemplatesService:\n    \"\"\"Service for managing and retrieving question templates.\"\"\"\n\n    def __init__(self) -> None:\n        \"\"\"Initialize the service with template library.\"\"\"\n        self._templates: list[QuestionTemplate] = self._build_template_library()\n\n    def _build_template_library(self) -> list[QuestionTemplate]:\n        \"\"\"Build the complete template library from therapy/coaching literature.\"\"\"\n        return [\n            # ============================================================\n            # SOCRATIC INQUIRY\n            # Source: Paul & Elder (2006) \"The Thinker's Guide to The Art of Socratic Questioning\"\n            # ============================================================\n            QuestionTemplate(\n                approach=InquiryApproach.SOCRATIC,\n                category=\"clarifying\",\n                template=\"What do you mean when you say '{concept}'?\",\n                when_to_use=\"When user uses an undefined or ambiguous term\",\n                source=\"Paul & Elder (2006) - The Art of Socratic Questioning\",\n                directness_variants={\n                    \"direct\": \"Define what you mean by '{concept}'.\",\n                    \"balanced\": \"What do you mean when you say '{concept}'?\",\n                    \"gentle\": \"I'm curious what '{concept}' means to you - could you say more?\",\n                },\n                pace_considerations=\"Allow time for reflection; this question often reveals hidden complexity\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.SOCRATIC,\n                category=\"clarifying\",\n                template=\"Can you give me an example of {concept}?\",\n                when_to_use=\"When abstract concept needs grounding in concrete experience\",\n                source=\"Paul & Elder (2006) - The Art of Socratic Questioning\",\n                directness_variants={\n                    \"direct\": \"Give me a specific example of {concept}.\",\n                    \"balanced\": \"Can you give me an example of {concept}?\",\n                    \"gentle\": \"What might be an example of {concept} in your experience?\",\n                },\n                pace_considerations=\"Concrete examples slow down and deepen exploration\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.SOCRATIC,\n                category=\"assumptions\",\n                template=\"What are you assuming when you say {statement}?\",\n                when_to_use=\"When user makes a claim that rests on hidden assumptions\",\n                source=\"Paul & Elder (2006) - The Art of Socratic Questioning\",\n                directness_variants={\n                    \"direct\": \"What assumption underlies {statement}?\",\n                    \"balanced\": \"What are you assuming when you say {statement}?\",\n                    \"gentle\": \"I notice {statement} - what might you be taking for granted there?\",\n                },\n                pace_considerations=\"Uncovering assumptions can be destabilizing; proceed gently\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.SOCRATIC,\n                category=\"reasoning\",\n                template=\"How does {concept_a} relate to {concept_b}?\",\n                when_to_use=\"When exploring relationships between ideas\",\n                source=\"Paul & Elder (2006) - The Art of Socratic Questioning\",\n                directness_variants={\n                    \"direct\": \"What's the connection between {concept_a} and {concept_b}?\",\n                    \"balanced\": \"How does {concept_a} relate to {concept_b}?\",\n                    \"gentle\": \"I'm wondering about the relationship between {concept_a} and {concept_b}...\",\n                },\n                pace_considerations=\"Relationship questions invite systems thinking\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.SOCRATIC,\n                category=\"implications\",\n                template=\"If {statement} is true, what else would have to be true?\",\n                when_to_use=\"When testing logical consistency and exploring consequences\",\n                source=\"Paul & Elder (2006) - The Art of Socratic Questioning\",\n                directness_variants={\n                    \"direct\": \"What follows logically from {statement}?\",\n                    \"balanced\": \"If {statement} is true, what else would have to be true?\",\n                    \"gentle\": \"What might follow from {statement}, I wonder?\",\n                },\n                pace_considerations=\"Implication questions can reveal contradictions; allow processing time\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.SOCRATIC,\n                category=\"evidence\",\n                template=\"What leads you to believe {claim}?\",\n                when_to_use=\"When user makes a claim that needs grounding in evidence\",\n                source=\"Paul & Elder (2006) - The Art of Socratic Questioning\",\n                directness_variants={\n                    \"direct\": \"What evidence supports {claim}?\",\n                    \"balanced\": \"What leads you to believe {claim}?\",\n                    \"gentle\": \"I'm curious what makes {claim} seem true to you?\",\n                },\n                pace_considerations=\"Evidence questions ground abstract thinking\",\n            ),\n\n            # ============================================================\n            # SOLUTION-FOCUSED BRIEF THERAPY\n            # Source: De Jong & Berg (2013) \"Interviewing for Solutions\"\n            # ============================================================\n            QuestionTemplate(\n                approach=InquiryApproach.SOLUTION_FOCUSED,\n                category=\"opening\",\n                template=\"What would be different if this problem was solved?\",\n                when_to_use=\"Early in session to orient toward desired outcome\",\n                source=\"De Jong & Berg (2013) - Interviewing for Solutions\",\n                directness_variants={\n                    \"direct\": \"Describe what life looks like when this is solved.\",\n                    \"balanced\": \"What would be different if this problem was solved?\",\n                    \"gentle\": \"Imagine this gets better - what might change?\",\n                },\n                pace_considerations=\"Future-oriented questions create hope and direction\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.SOLUTION_FOCUSED,\n                category=\"exceptions\",\n                template=\"When is this problem less severe or absent?\",\n                when_to_use=\"When user is stuck in problem-saturated narrative\",\n                source=\"De Jong & Berg (2013) - Interviewing for Solutions\",\n                directness_variants={\n                    \"direct\": \"When doesn't this happen?\",\n                    \"balanced\": \"When is this problem less severe or absent?\",\n                    \"gentle\": \"Are there times when things feel a little easier?\",\n                },\n                pace_considerations=\"Exception questions reveal existing resources\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.SOLUTION_FOCUSED,\n                category=\"scaling\",\n                template=\"On a scale of 1-10, where 10 is {goal} fully achieved and 1 is the opposite, where are you now?\",\n                when_to_use=\"To establish baseline and track progress\",\n                source=\"De Jong & Berg (2013) - Interviewing for Solutions\",\n                directness_variants={\n                    \"direct\": \"Rate where you are: 1-10, where 10 is {goal} achieved.\",\n                    \"balanced\": \"On a scale of 1-10, where 10 is {goal} fully achieved, where are you?\",\n                    \"gentle\": \"If you had to guess, where might you be on a 1-10 scale toward {goal}?\",\n                },\n                pace_considerations=\"Scaling makes progress visible and concrete\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.SOLUTION_FOCUSED,\n                category=\"scaling\",\n                template=\"What would one point higher on the scale look like?\",\n                when_to_use=\"After establishing current position on scale\",\n                source=\"De Jong & Berg (2013) - Interviewing for Solutions\",\n                directness_variants={\n                    \"direct\": \"Describe what one point higher looks like.\",\n                    \"balanced\": \"What would one point higher on the scale look like?\",\n                    \"gentle\": \"What might be a small sign you'd moved up just one point?\",\n                },\n                pace_considerations=\"Small increment questions make change feel achievable\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.SOLUTION_FOCUSED,\n                category=\"coping\",\n                template=\"How have you managed to keep things from getting worse?\",\n                when_to_use=\"When user feels helpless or defeated\",\n                source=\"De Jong & Berg (2013) - Interviewing for Solutions\",\n                directness_variants={\n                    \"direct\": \"What's keeping this from getting worse?\",\n                    \"balanced\": \"How have you managed to keep things from getting worse?\",\n                    \"gentle\": \"I'm noticing you're still here, still trying - what's helped you keep going?\",\n                },\n                pace_considerations=\"Coping questions highlight resilience and agency\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.SOLUTION_FOCUSED,\n                category=\"resources\",\n                template=\"What resources or strengths have you used in similar situations?\",\n                when_to_use=\"When user needs reminder of past competence\",\n                source=\"De Jong & Berg (2013) - Interviewing for Solutions\",\n                directness_variants={\n                    \"direct\": \"What strengths can you draw on here?\",\n                    \"balanced\": \"What resources or strengths have you used in similar situations?\",\n                    \"gentle\": \"What's helped you through difficult times before?\",\n                },\n                pace_considerations=\"Resource questions activate existing capabilities\",\n            ),\n\n            # ============================================================\n            # PHENOMENOLOGICAL INQUIRY / FOCUSING\n            # Source: Gendlin (1982) \"Focusing\" and Cornell (2013) \"The Radical Acceptance of Everything\"\n            # ============================================================\n            QuestionTemplate(\n                approach=InquiryApproach.PHENOMENOLOGICAL,\n                category=\"grounding\",\n                template=\"What do you notice in your body as you say that?\",\n                when_to_use=\"When user is abstract or disconnected from felt experience\",\n                source=\"Gendlin (1982) - Focusing\",\n                directness_variants={\n                    \"direct\": \"Check your body - what's there?\",\n                    \"balanced\": \"What do you notice in your body as you say that?\",\n                    \"gentle\": \"If you tune into your body for a moment, what's present?\",\n                },\n                pace_considerations=\"Body questions require slowing down; allow 10-15 seconds\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.PHENOMENOLOGICAL,\n                category=\"deepening\",\n                template=\"Can you stay with that feeling for a moment and see what it wants to say?\",\n                when_to_use=\"When felt sense has emerged but not yet articulated\",\n                source=\"Gendlin (1982) - Focusing\",\n                directness_variants={\n                    \"direct\": \"Stay with that feeling - what does it want to say?\",\n                    \"balanced\": \"Can you stay with that feeling and see what it wants to say?\",\n                    \"gentle\": \"If that feeling could speak, what might it say?\",\n                },\n                pace_considerations=\"Staying with feelings is advanced; user needs capacity\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.PHENOMENOLOGICAL,\n                category=\"naming\",\n                template=\"What word or image captures the quality of {sensation}?\",\n                when_to_use=\"When helping user articulate vague bodily sense\",\n                source=\"Gendlin (1982) - Focusing\",\n                directness_variants={\n                    \"direct\": \"What word fits {sensation}?\",\n                    \"balanced\": \"What word or image captures the quality of {sensation}?\",\n                    \"gentle\": \"Is there a word or image that might fit {sensation}?\",\n                },\n                pace_considerations=\"Finding the right word creates 'felt shift' - be patient\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.PHENOMENOLOGICAL,\n                category=\"welcoming\",\n                template=\"Can you say hello to {feeling} and let it know you're here with it?\",\n                when_to_use=\"When user is resisting or fighting an emotion\",\n                source=\"Cornell (2013) - The Radical Acceptance of Everything\",\n                directness_variants={\n                    \"direct\": \"Acknowledge {feeling} - say hello to it.\",\n                    \"balanced\": \"Can you say hello to {feeling} and let it know you're here with it?\",\n                    \"gentle\": \"What if you could just be with {feeling}, without changing it?\",\n                },\n                pace_considerations=\"Radical acceptance approach - needs gentle, permissive framing\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.PHENOMENOLOGICAL,\n                category=\"checking\",\n                template=\"Does {word} feel right for what you're experiencing, or is there something more accurate?\",\n                when_to_use=\"After user has named an experience - verify the fit\",\n                source=\"Gendlin (1982) - Focusing\",\n                directness_variants={\n                    \"direct\": \"Is {word} the right word?\",\n                    \"balanced\": \"Does {word} feel right, or is there something more accurate?\",\n                    \"gentle\": \"How does {word} sit with you - does it fit?\",\n                },\n                pace_considerations=\"Checking creates precision and deeper contact with experience\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.PHENOMENOLOGICAL,\n                category=\"sensation\",\n                template=\"Where in your body do you feel {emotion}?\",\n                when_to_use=\"When user names emotion but stays cognitive\",\n                source=\"Gendlin (1982) - Focusing\",\n                directness_variants={\n                    \"direct\": \"Where is {emotion} in your body?\",\n                    \"balanced\": \"Where in your body do you feel {emotion}?\",\n                    \"gentle\": \"If you scan your body, where might {emotion} be showing up?\",\n                },\n                pace_considerations=\"Locating emotions in body creates embodied awareness\",\n            ),\n\n            # ============================================================\n            # SYSTEMS THINKING\n            # Source: Meadows (2008) \"Thinking in Systems\" and Senge (1990) \"The Fifth Discipline\"\n            # ============================================================\n            QuestionTemplate(\n                approach=InquiryApproach.SYSTEMS,\n                category=\"connections\",\n                template=\"How does changing {element_a} affect {element_b}?\",\n                when_to_use=\"When exploring relationships in a system\",\n                source=\"Meadows (2008) - Thinking in Systems\",\n                directness_variants={\n                    \"direct\": \"What's the causal link between {element_a} and {element_b}?\",\n                    \"balanced\": \"How does changing {element_a} affect {element_b}?\",\n                    \"gentle\": \"I'm curious about the connection between {element_a} and {element_b}...\",\n                },\n                pace_considerations=\"Causal questions invite complexity - allow thinking time\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.SYSTEMS,\n                category=\"feedback\",\n                template=\"What happens when {action} creates {result}, and then {result} influences {action}?\",\n                when_to_use=\"When identifying feedback loops\",\n                source=\"Meadows (2008) - Thinking in Systems\",\n                directness_variants={\n                    \"direct\": \"Trace the feedback loop: {action} → {result} → ?\",\n                    \"balanced\": \"What happens when {action} creates {result}, which then influences {action}?\",\n                    \"gentle\": \"It sounds like {action} and {result} might be influencing each other - how does that cycle work?\",\n                },\n                pace_considerations=\"Feedback loops are cognitively demanding - use visual aids if possible\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.SYSTEMS,\n                category=\"emergence\",\n                template=\"What patterns emerge when {elements} interact over time?\",\n                when_to_use=\"When exploring emergent properties of a system\",\n                source=\"Meadows (2008) - Thinking in Systems\",\n                directness_variants={\n                    \"direct\": \"What patterns do you see emerging from {elements}?\",\n                    \"balanced\": \"What patterns emerge when {elements} interact over time?\",\n                    \"gentle\": \"As you step back and look at {elements} together, what do you notice?\",\n                },\n                pace_considerations=\"Emergence requires zooming out - create spaciousness\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.SYSTEMS,\n                category=\"leverage\",\n                template=\"Where could a small change in {system} create a large effect?\",\n                when_to_use=\"When looking for high-leverage interventions\",\n                source=\"Meadows (2008) - Thinking in Systems\",\n                directness_variants={\n                    \"direct\": \"What's the leverage point in {system}?\",\n                    \"balanced\": \"Where could a small change create a large effect in {system}?\",\n                    \"gentle\": \"What's something small that might shift {system} in a big way?\",\n                },\n                pace_considerations=\"Leverage point questions focus energy efficiently\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.SYSTEMS,\n                category=\"boundaries\",\n                template=\"What are you including in {system} and what are you leaving out?\",\n                when_to_use=\"When system boundaries need examination\",\n                source=\"Meadows (2008) - Thinking in Systems\",\n                directness_variants={\n                    \"direct\": \"Define the boundaries of {system}.\",\n                    \"balanced\": \"What are you including in {system} and what are you leaving out?\",\n                    \"gentle\": \"How are you thinking about what's inside vs. outside {system}?\",\n                },\n                pace_considerations=\"Boundary questions reveal hidden assumptions\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.SYSTEMS,\n                category=\"delays\",\n                template=\"What delays exist between {action} and {outcome}?\",\n                when_to_use=\"When timing and delays are relevant\",\n                source=\"Senge (1990) - The Fifth Discipline\",\n                directness_variants={\n                    \"direct\": \"How long between {action} and {outcome}?\",\n                    \"balanced\": \"What delays exist between {action} and {outcome}?\",\n                    \"gentle\": \"How much time passes between {action} and seeing {outcome}?\",\n                },\n                pace_considerations=\"Delay awareness prevents premature conclusions\",\n            ),\n\n            # ============================================================\n            # METACOGNITIVE INQUIRY\n            # Source: Flavell (1979) and Schraw & Moshman (1995) on Metacognition\n            # ============================================================\n            QuestionTemplate(\n                approach=InquiryApproach.METACOGNITIVE,\n                category=\"reflection\",\n                template=\"How are you approaching this problem?\",\n                when_to_use=\"When user needs to step back from content to examine process\",\n                source=\"Flavell (1979) - Metacognition and cognitive monitoring\",\n                directness_variants={\n                    \"direct\": \"Describe your problem-solving approach.\",\n                    \"balanced\": \"How are you approaching this problem?\",\n                    \"gentle\": \"I'm curious about your thinking process here - what's your approach?\",\n                },\n                pace_considerations=\"Metacognitive questions create healthy distance\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.METACOGNITIVE,\n                category=\"assumptions\",\n                template=\"What assumptions are you making about {situation}?\",\n                when_to_use=\"When hidden assumptions may be constraining thinking\",\n                source=\"Schraw & Moshman (1995) - Metacognitive theories\",\n                directness_variants={\n                    \"direct\": \"List your assumptions about {situation}.\",\n                    \"balanced\": \"What assumptions are you making about {situation}?\",\n                    \"gentle\": \"What might you be taking for granted about {situation}?\",\n                },\n                pace_considerations=\"Surfacing assumptions can be destabilizing - proceed gently\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.METACOGNITIVE,\n                category=\"perspective\",\n                template=\"What would you tell a friend who came to you with this situation?\",\n                when_to_use=\"When user needs distance from their own situation\",\n                source=\"Cognitive therapy tradition - self-distancing technique\",\n                directness_variants={\n                    \"direct\": \"Advise yourself as if you were someone else.\",\n                    \"balanced\": \"What would you tell a friend facing this situation?\",\n                    \"gentle\": \"If a good friend told you about this, what might you say to them?\",\n                },\n                pace_considerations=\"Third-person perspective creates helpful objectivity\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.METACOGNITIVE,\n                category=\"monitoring\",\n                template=\"How confident are you in {conclusion}?\",\n                when_to_use=\"When calibrating certainty and identifying knowledge gaps\",\n                source=\"Schraw & Moshman (1995) - Metacognitive theories\",\n                directness_variants={\n                    \"direct\": \"Rate your confidence in {conclusion}: 1-10.\",\n                    \"balanced\": \"How confident are you in {conclusion}?\",\n                    \"gentle\": \"How sure do you feel about {conclusion}?\",\n                },\n                pace_considerations=\"Confidence calibration prevents overcommitment\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.METACOGNITIVE,\n                category=\"strategy\",\n                template=\"Is this thinking strategy working, or do you need to try something different?\",\n                when_to_use=\"When user seems stuck in unproductive pattern\",\n                source=\"Flavell (1979) - Metacognition and cognitive monitoring\",\n                directness_variants={\n                    \"direct\": \"This approach isn't working - what else could you try?\",\n                    \"balanced\": \"Is this strategy working, or should you try something different?\",\n                    \"gentle\": \"How is this approach feeling - helpful, or time for something new?\",\n                },\n                pace_considerations=\"Strategy evaluation prevents perseveration\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.METACOGNITIVE,\n                category=\"learning\",\n                template=\"What are you learning about how you think through {domain}?\",\n                when_to_use=\"When highlighting patterns in user's thinking process\",\n                source=\"Schraw & Moshman (1995) - Metacognitive theories\",\n                directness_variants={\n                    \"direct\": \"What patterns do you notice in how you think about {domain}?\",\n                    \"balanced\": \"What are you learning about how you think through {domain}?\",\n                    \"gentle\": \"As you explore {domain}, what do you notice about your thinking?\",\n                },\n                pace_considerations=\"Meta-learning questions build self-awareness over time\",\n            ),\n        ]\n\n    def get_templates_for_approach(\n        self, approach: InquiryApproach, category: str | None = None\n    ) -> list[QuestionTemplate]:\n        \"\"\"Get all templates for a specific approach, optionally filtered by category.\n\n        Args:\n            approach: The inquiry approach to filter by\n            category: Optional category to further filter (e.g., \"clarifying\", \"deepening\")\n\n        Returns:\n            List of matching question templates\n        \"\"\"\n        templates = [t for t in self._templates if t.approach == approach]\n\n        if category:\n            templates = [t for t in templates if t.category == category]\n\n        return templates\n\n    def get_template_by_criteria(\n        self, approach: InquiryApproach, category: str, context: str\n    ) -> QuestionTemplate | None:\n        \"\"\"Get a specific template matching approach, category, and context keywords.\n\n        Args:\n            approach: The inquiry approach\n            category: The template category\n            context: Context string to match against when_to_use\n\n        Returns:\n            Matching template or None\n        \"\"\"\n        candidates = self.get_templates_for_approach(approach, category)\n\n        # Simple keyword matching in when_to_use field\n        context_lower = context.lower()\n        for template in candidates:\n            if any(\n                keyword in context_lower\n                for keyword in template.when_to_use.lower().split()\n            ):\n                return template\n\n        # Return first matching category if no context match\n        return candidates[0] if candidates else None\n\n    def adapt_template(\n        self,\n        template: QuestionTemplate,\n        directness: str = \"balanced\",\n        placeholders: dict[str, Any] | None = None,\n    ) -> str:\n        \"\"\"Adapt a template to profile settings and fill in placeholders.\n\n        Args:\n            template: The template to adapt\n            directness: Profile directness setting (direct/balanced/gentle)\n            placeholders: Dictionary of placeholder values to fill in template\n\n        Returns:\n            Adapted and filled question string\n        \"\"\"\n        # Get directness variant or fall back to default template\n        question = template.directness_variants.get(directness, template.template)\n\n        # Fill in placeholders if provided\n        if placeholders:\n            try:\n                question = question.format(**placeholders)\n            except KeyError as e:\n                # If placeholder is missing, return template with unfilled placeholders\n                # This is acceptable - AI can fill them contextually\n                pass\n\n        return question\n\n    def generate_question_batch(\n        self,\n        approach: InquiryApproach,\n        state: UserState,\n        context: str,\n        directness: str = \"balanced\",\n        abstraction: str = \"mixed\",\n        count: int = 3,\n    ) -> QuestionBatch:\n        \"\"\"Generate a batch of questions for a given state and approach.\n\n        Args:\n            approach: The inquiry approach to use\n            state: The detected user state\n            context: Current conversation context\n            directness: Profile directness setting\n            abstraction: Profile abstraction preference\n            count: Number of questions to generate\n\n        Returns:\n            QuestionBatch with adapted questions\n        \"\"\"\n        templates = self.get_templates_for_approach(approach)\n\n        # Select diverse templates (different categories)\n        selected_templates: list[QuestionTemplate] = []\n        categories_used: set[str] = set()\n\n        for template in templates:\n            if template.category not in categories_used:\n                selected_templates.append(template)\n                categories_used.add(template.category)\n                if len(selected_templates) >= count:\n                    break\n\n        # If we don't have enough unique categories, add more from any category\n        if len(selected_templates) < count:\n            for template in templates:\n                if template not in selected_templates:\n                    selected_templates.append(template)\n                    if len(selected_templates) >= count:\n                        break\n\n        # Adapt templates to profile settings\n        questions = [\n            self.adapt_template(template, directness=directness)\n            for template in selected_templates\n        ]\n\n        adaptations = [f\"directness={directness}\"]\n        if abstraction != \"mixed\":\n            adaptations.append(f\"abstraction={abstraction}\")\n\n        return QuestionBatch(\n            approach=approach,\n            state=state,\n            questions=questions,\n            context=context,\n            profile_adaptations_applied=adaptations,\n        )\n\n    def get_approach_description(self, approach: InquiryApproach) -> str:\n        \"\"\"Get a description of an inquiry approach.\n\n        Args:\n            approach: The inquiry approach\n\n        Returns:\n            Description string for system prompts\n        \"\"\"\n        from ies_backend.schemas.question_engine import APPROACH_DESCRIPTIONS\n\n        return APPROACH_DESCRIPTIONS.get(\n            approach, \"No description available for this approach.\"\n        )\n\n    def get_all_approaches(self) -> list[InquiryApproach]:\n        \"\"\"Get list of all inquiry approaches that have templates.\n\n        Returns:\n            List of InquiryApproach values with templates\n        \"\"\"\n        approaches = {t.approach for t in self._templates}\n        return sorted(approaches, key=lambda a: a.value)\n\n    def get_categories_for_approach(self, approach: InquiryApproach) -> list[str]:\n        \"\"\"Get all categories available for an approach.\n\n        Args:\n            approach: The inquiry approach\n\n        Returns:\n            List of category names\n        \"\"\"\n        categories = {\n            t.category for t in self._templates if t.approach == approach\n        }\n        return sorted(categories)\n\n    def get_template_count(self, approach: InquiryApproach | None = None) -> int:\n        \"\"\"Get count of templates, optionally filtered by approach.\n\n        Args:\n            approach: Optional approach to filter by\n\n        Returns:\n            Number of templates\n        \"\"\"\n        if approach:\n            return len([t for t in self._templates if t.approach == approach])\n        return len(self._templates)\n"
    }
  }
]

---

### User
> 12/1/2025, 2:42:17 PM

[
  {
    "type": "tool_result",
    "content": "<tool_use_error>File has not been read yet. Read it first before writing to it.</tool_use_error>",
    "is_error": true,
    "tool_use_id": "toolu_013T6KPD5r1mK8uruDvScHLs"
  }
]

---

### Assistant
> 12/1/2025, 2:42:21 PM

[
  {
    "type": "text",
    "text": "The file doesn't exist yet, so I can create it directly:"
  }
]

---

### Assistant
> 12/1/2025, 2:42:22 PM

[
  {
    "type": "tool_use",
    "id": "toolu_012VYm71REHCzPztLwCoyuKK",
    "name": "Bash",
    "input": {
      "command": "ls -la /home/chris/dev/projects/codex/brain_explore/ies-backend/src/ies_backend/services/",
      "description": "Check if services directory exists"
    }
  }
]

---

### User
> 12/1/2025, 2:42:22 PM

[
  {
    "tool_use_id": "toolu_012VYm71REHCzPztLwCoyuKK",
    "type": "tool_result",
    "content": "total 108\ndrwxrwxr-x 3 chris chris  4096 Dec  1 14:41 .\ndrwxrwxr-x 7 chris chris  4096 Dec  1 14:41 ..\n-rw------- 1 chris chris    31 Dec  1 14:12 __init__.py\ndrwxrwxr-x 2 chris chris  4096 Dec  1 14:42 __pycache__\n-rw------- 1 chris chris  9256 Dec  1 14:39 approach_selection_service.py\n-rw------- 1 chris chris  6940 Dec  1 14:26 entity_storage_service.py\n-rw------- 1 chris chris  5595 Dec  1 14:26 extraction_service.py\n-rw------- 1 chris chris  2086 Dec  1 14:19 neo4j_client.py\n-rw------- 1 chris chris 10099 Dec  1 14:20 profile_service.py\n-rw------- 1 chris chris 11373 Dec  1 14:41 question_templates_service.py\n-rw------- 1 chris chris  4474 Dec  1 14:26 session_document_service.py\n-rw------- 1 chris chris  4252 Dec  1 14:21 siyuan_client.py\n-rw------- 1 chris chris  6252 Dec  1 14:22 siyuan_profile_service.py\n-rw------- 1 chris chris 10021 Dec  1 14:38 state_detection_service.py",
    "is_error": false
  }
]

---

### Assistant
> 12/1/2025, 2:42:25 PM

[
  {
    "type": "text",
    "text": "The file already exists! Let me read it first:"
  }
]

---

### Assistant
> 12/1/2025, 2:42:25 PM

[
  {
    "type": "tool_use",
    "id": "toolu_01Ays2PtwpnseFLMuiewSUjT",
    "name": "Read",
    "input": {
      "file_path": "/home/chris/dev/projects/codex/brain_explore/ies-backend/src/ies_backend/services/question_templates_service.py"
    }
  }
]

---

### User
> 12/1/2025, 2:42:25 PM

[
  {
    "tool_use_id": "toolu_01Ays2PtwpnseFLMuiewSUjT",
    "type": "tool_result",
    "content": "     1→\"\"\"Question templates service for managing and retrieving question patterns.\"\"\"\n     2→\n     3→from ..schemas.question_engine import (\n     4→    InquiryApproach,\n     5→    QuestionTemplate,\n     6→)\n     7→\n     8→\n     9→# Question template library\n    10→# In future, could be loaded from database or JSON file\n    11→QUESTION_TEMPLATES = [\n    12→    # SOCRATIC - Clarifying\n    13→    QuestionTemplate(\n    14→        approach=InquiryApproach.SOCRATIC,\n    15→        category=\"clarifying\",\n    16→        template=\"What do you mean by '{concept}'?\",\n    17→        when_to_use=\"When user uses abstract or ambiguous term\",\n    18→        directness_variants={\n    19→            \"gentle\": \"I'm curious what '{concept}' means to you?\",\n    20→            \"balanced\": \"What do you mean by '{concept}'?\",\n    21→            \"direct\": \"Define '{concept}' - what exactly does that mean?\",\n    22→        },\n    23→    ),\n    24→    QuestionTemplate(\n    25→        approach=InquiryApproach.SOCRATIC,\n    26→        category=\"clarifying\",\n    27→        template=\"Can you give an example of {concept}?\",\n    28→        when_to_use=\"When concept is too abstract, need concrete grounding\",\n    29→        directness_variants={\n    30→            \"gentle\": \"Would an example help clarify what you mean?\",\n    31→            \"balanced\": \"Can you give an example of {concept}?\",\n    32→            \"direct\": \"Give me a specific example of {concept}.\",\n    33→        },\n    34→    ),\n    35→    # SOCRATIC - Testing assumptions\n    36→    QuestionTemplate(\n    37→        approach=InquiryApproach.SOCRATIC,\n    38→        category=\"deepening\",\n    39→        template=\"What would have to be true for {assumption} to hold?\",\n    40→        when_to_use=\"When user makes an implicit assumption\",\n    41→        directness_variants={\n    42→            \"gentle\": \"I wonder what needs to be true for {assumption}?\",\n    43→            \"balanced\": \"What would have to be true for {assumption} to hold?\",\n    44→            \"direct\": \"What's the underlying assumption in {assumption}?\",\n    45→        },\n    46→    ),\n    47→    QuestionTemplate(\n    48→        approach=InquiryApproach.SOCRATIC,\n    49→        category=\"challenging\",\n    50→        template=\"How does {concept_a} relate to {concept_b}?\",\n    51→        when_to_use=\"When exploring connections between ideas\",\n    52→        directness_variants={\n    53→            \"gentle\": \"I'm noticing both {concept_a} and {concept_b} - how do they connect?\",\n    54→            \"balanced\": \"How does {concept_a} relate to {concept_b}?\",\n    55→            \"direct\": \"What's the relationship between {concept_a} and {concept_b}?\",\n    56→        },\n    57→    ),\n    58→    # SOLUTION-FOCUSED - Exception finding\n    59→    QuestionTemplate(\n    60→        approach=InquiryApproach.SOLUTION_FOCUSED,\n    61→        category=\"clarifying\",\n    62→        template=\"When has {problem} been less of an issue?\",\n    63→        when_to_use=\"When user describes persistent problem\",\n    64→        directness_variants={\n    65→            \"gentle\": \"Are there times when {problem} feels a bit easier?\",\n    66→            \"balanced\": \"When has {problem} been less of an issue?\",\n    67→            \"direct\": \"When doesn't {problem} happen? Find the exceptions.\",\n    68→        },\n    69→    ),\n    70→    QuestionTemplate(\n    71→        approach=InquiryApproach.SOLUTION_FOCUSED,\n    72→        category=\"deepening\",\n    73→        template=\"On a scale of 1-10, where are you with {goal}?\",\n    74→        when_to_use=\"When gauging progress or establishing baseline\",\n    75→        directness_variants={\n    76→            \"gentle\": \"If you had to put a number on it, where would you say you are with {goal}?\",\n    77→            \"balanced\": \"On a scale of 1-10, where are you with {goal}?\",\n    78→            \"direct\": \"Rate yourself 1-10 on {goal}. What's the number?\",\n    79→        },\n    80→        pace_considerations=\"Slower pace: ask 'what makes it that number?' as follow-up\",\n    81→    ),\n    82→    QuestionTemplate(\n    83→        approach=InquiryApproach.SOLUTION_FOCUSED,\n    84→        category=\"challenging\",\n    85→        template=\"What's one small thing that would move you from {current} to {next}?\",\n    86→        when_to_use=\"After scaling question, to identify concrete action\",\n    87→        directness_variants={\n    88→            \"gentle\": \"What might be one tiny step toward {next}?\",\n    89→            \"balanced\": \"What's one small thing that would move you from {current} to {next}?\",\n    90→            \"direct\": \"Name one action that gets you from {current} to {next}.\",\n    91→        },\n    92→    ),\n    93→    # PHENOMENOLOGICAL - Felt sense\n    94→    QuestionTemplate(\n    95→        approach=InquiryApproach.PHENOMENOLOGICAL,\n    96→        category=\"grounding\",\n    97→        template=\"What do you notice in your body when you say that?\",\n    98→        when_to_use=\"When accessing embodied knowing or emotional content\",\n    99→        directness_variants={\n   100→            \"gentle\": \"I'm curious if you notice anything in your body right now?\",\n   101→            \"balanced\": \"What do you notice in your body when you say that?\",\n   102→            \"direct\": \"Check your body. What's happening physically?\",\n   103→        },\n   104→        pace_considerations=\"SLOW - give space for sensing\",\n   105→    ),\n   106→    QuestionTemplate(\n   107→        approach=InquiryApproach.PHENOMENOLOGICAL,\n   108→        category=\"deepening\",\n   109→        template=\"Can you stay with {sensation} for a moment?\",\n   110→        when_to_use=\"When user mentions physical sensation or feeling\",\n   111→        directness_variants={\n   112→            \"gentle\": \"Would it be okay to just be with {sensation} for a bit?\",\n   113→            \"balanced\": \"Can you stay with {sensation} for a moment?\",\n   114→            \"direct\": \"Stay with {sensation}. Don't explain it, just notice it.\",\n   115→        },\n   116→        pace_considerations=\"VERY SLOW - this takes time\",\n   117→    ),\n   118→    QuestionTemplate(\n   119→        approach=InquiryApproach.PHENOMENOLOGICAL,\n   120→        category=\"clarifying\",\n   121→        template=\"What word or image fits that feeling?\",\n   122→        when_to_use=\"When helping user symbolize felt sense\",\n   123→        directness_variants={\n   124→            \"gentle\": \"Is there a word or image that seems to fit?\",\n   125→            \"balanced\": \"What word or image fits that feeling?\",\n   126→            \"direct\": \"Name it. What word captures that?\",\n   127→        },\n   128→    ),\n   129→    # SYSTEMS - Connections and patterns\n   130→    QuestionTemplate(\n   131→        approach=InquiryApproach.SYSTEMS,\n   132→        category=\"deepening\",\n   133→        template=\"What happens to {element_b} when {element_a} changes?\",\n   134→        when_to_use=\"When exploring system dynamics and feedback\",\n   135→        directness_variants={\n   136→            \"gentle\": \"I wonder how {element_a} might affect {element_b}?\",\n   137→            \"balanced\": \"What happens to {element_b} when {element_a} changes?\",\n   138→            \"direct\": \"Map the connection: {element_a} changes, then what happens to {element_b}?\",\n   139→        },\n   140→    ),\n   141→    QuestionTemplate(\n   142→        approach=InquiryApproach.SYSTEMS,\n   143→        category=\"challenging\",\n   144→        template=\"What might be reinforcing {pattern}?\",\n   145→        when_to_use=\"When identifying feedback loops\",\n   146→        directness_variants={\n   147→            \"gentle\": \"What do you think might be keeping {pattern} going?\",\n   148→            \"balanced\": \"What might be reinforcing {pattern}?\",\n   149→            \"direct\": \"What's the feedback loop? What maintains {pattern}?\",\n   150→        },\n   151→    ),\n   152→    QuestionTemplate(\n   153→        approach=InquiryApproach.SYSTEMS,\n   154→        category=\"clarifying\",\n   155→        template=\"Where else does {pattern} show up?\",\n   156→        when_to_use=\"When looking for pattern repetition across contexts\",\n   157→        directness_variants={\n   158→            \"gentle\": \"Does {pattern} happen in other areas of your life?\",\n   159→            \"balanced\": \"Where else does {pattern} show up?\",\n   160→            \"direct\": \"Map it: where else is {pattern} present?\",\n   161→        },\n   162→    ),\n   163→    # METACOGNITIVE - Process reflection\n   164→    QuestionTemplate(\n   165→        approach=InquiryApproach.METACOGNITIVE,\n   166→        category=\"clarifying\",\n   167→        template=\"How are you thinking about {topic}?\",\n   168→        when_to_use=\"When reflecting on thinking process itself\",\n   169→        directness_variants={\n   170→            \"gentle\": \"What's your way of approaching {topic}?\",\n   171→            \"balanced\": \"How are you thinking about {topic}?\",\n   172→            \"direct\": \"Describe your mental process for {topic}.\",\n   173→        },\n   174→    ),\n   175→    QuestionTemplate(\n   176→        approach=InquiryApproach.METACOGNITIVE,\n   177→        category=\"deepening\",\n   178→        template=\"What assumptions are you making about {topic}?\",\n   179→        when_to_use=\"When surfacing implicit frameworks\",\n   180→        directness_variants={\n   181→            \"gentle\": \"What are you taking for granted about {topic}?\",\n   182→            \"balanced\": \"What assumptions are you making about {topic}?\",\n   183→            \"direct\": \"List your assumptions about {topic}.\",\n   184→        },\n   185→    ),\n   186→    QuestionTemplate(\n   187→        approach=InquiryApproach.METACOGNITIVE,\n   188→        category=\"challenging\",\n   189→        template=\"What would you tell someone else in this situation?\",\n   190→        when_to_use=\"When creating helpful distance/perspective\",\n   191→        directness_variants={\n   192→            \"gentle\": \"If a friend came to you with this, what might you say?\",\n   193→            \"balanced\": \"What would you tell someone else in this situation?\",\n   194→            \"direct\": \"Advise yourself from the outside. What would you say?\",\n   195→        },\n   196→    ),\n   197→]\n   198→\n   199→\n   200→class QuestionTemplatesService:\n   201→    \"\"\"Service for managing question templates and generating adapted questions.\"\"\"\n   202→\n   203→    def __init__(self):\n   204→        self.templates = QUESTION_TEMPLATES\n   205→\n   206→    def get_templates(\n   207→        self,\n   208→        approach: InquiryApproach | None = None,\n   209→        category: str | None = None,\n   210→    ) -> list[QuestionTemplate]:\n   211→        \"\"\"\n   212→        Get question templates filtered by approach and/or category.\n   213→\n   214→        Args:\n   215→            approach: Filter by inquiry approach (optional)\n   216→            category: Filter by category (optional)\n   217→\n   218→        Returns:\n   219→            List of matching question templates\n   220→        \"\"\"\n   221→        templates = self.templates\n   222→\n   223→        if approach:\n   224→            templates = [t for t in templates if t.approach == approach]\n   225→\n   226→        if category:\n   227→            templates = [t for t in templates if t.category == category]\n   228→\n   229→        return templates\n   230→\n   231→    def get_template_by_category(\n   232→        self,\n   233→        approach: InquiryApproach,\n   234→        category: str,\n   235→    ) -> QuestionTemplate | None:\n   236→        \"\"\"Get first template matching approach and category.\"\"\"\n   237→        templates = self.get_templates(approach=approach, category=category)\n   238→        return templates[0] if templates else None\n   239→\n   240→    def adapt_template(\n   241→        self,\n   242→        template: QuestionTemplate,\n   243→        directness: str = \"balanced\",\n   244→        placeholders: dict[str, str] | None = None,\n   245→    ) -> str:\n   246→        \"\"\"\n   247→        Adapt a template to specific directness level and fill placeholders.\n   248→\n   249→        Args:\n   250→            template: The question template\n   251→            directness: One of \"gentle\", \"balanced\", \"direct\"\n   252→            placeholders: Dictionary of placeholder values\n   253→\n   254→        Returns:\n   255→            Adapted and filled question string\n   256→        \"\"\"\n   257→        # Get directness variant if available\n   258→        if directness in template.directness_variants:\n   259→            question = template.directness_variants[directness]\n   260→        else:\n   261→            question = template.template\n   262→\n   263→        # Fill placeholders if provided\n   264→        if placeholders:\n   265→            try:\n   266→                question = question.format(**placeholders)\n   267→            except KeyError:\n   268→                # If placeholders don't match, return template as-is\n   269→                pass\n   270→\n   271→        return question\n   272→\n   273→    def get_categories(self, approach: InquiryApproach | None = None) -> list[str]:\n   274→        \"\"\"Get list of available categories, optionally filtered by approach.\"\"\"\n   275→        templates = self.get_templates(approach=approach)\n   276→        return sorted(set(t.category for t in templates))\n   277→\n   278→\n   279→# Singleton instance\n   280→question_templates_service = QuestionTemplatesService()\n   281→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"
  }
]

---

### Assistant
> 12/1/2025, 2:42:29 PM

[
  {
    "type": "text",
    "text": "Now I'll update the existing file with the comprehensive research-backed templates:"
  }
]

---

### Assistant
> 12/1/2025, 2:44:38 PM

[
  {
    "type": "tool_use",
    "id": "toolu_01Vi3STuryr4A84ZcCubmkmt",
    "name": "Write",
    "input": {
      "file_path": "/home/chris/dev/projects/codex/brain_explore/ies-backend/src/ies_backend/services/question_templates_service.py",
      "content": "\"\"\"Question Templates Service for the Intelligent Exploration System.\n\nThis service provides research-backed question templates from therapy and coaching literature,\norganized by inquiry approach and adapted to user profile settings.\n\"\"\"\n\nfrom typing import Any\n\nfrom ies_backend.schemas.question_engine import (\n    InquiryApproach,\n    QuestionBatch,\n    QuestionTemplate,\n    UserState,\n)\n\n\nclass QuestionTemplatesService:\n    \"\"\"Service for managing and retrieving question templates.\"\"\"\n\n    def __init__(self) -> None:\n        \"\"\"Initialize the service with template library.\"\"\"\n        self._templates: list[QuestionTemplate] = self._build_template_library()\n\n    def _build_template_library(self) -> list[QuestionTemplate]:\n        \"\"\"Build the complete template library from therapy/coaching literature.\"\"\"\n        return [\n            # ============================================================\n            # SOCRATIC INQUIRY\n            # Source: Paul & Elder (2006) \"The Thinker's Guide to The Art of Socratic Questioning\"\n            # ============================================================\n            QuestionTemplate(\n                approach=InquiryApproach.SOCRATIC,\n                category=\"clarifying\",\n                template=\"What do you mean when you say '{concept}'?\",\n                when_to_use=\"When user uses an undefined or ambiguous term\",\n                source=\"Paul & Elder (2006) - The Art of Socratic Questioning\",\n                directness_variants={\n                    \"direct\": \"Define what you mean by '{concept}'.\",\n                    \"balanced\": \"What do you mean when you say '{concept}'?\",\n                    \"gentle\": \"I'm curious what '{concept}' means to you - could you say more?\",\n                },\n                pace_considerations=\"Allow time for reflection; this question often reveals hidden complexity\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.SOCRATIC,\n                category=\"clarifying\",\n                template=\"Can you give me an example of {concept}?\",\n                when_to_use=\"When abstract concept needs grounding in concrete experience\",\n                source=\"Paul & Elder (2006) - The Art of Socratic Questioning\",\n                directness_variants={\n                    \"direct\": \"Give me a specific example of {concept}.\",\n                    \"balanced\": \"Can you give me an example of {concept}?\",\n                    \"gentle\": \"What might be an example of {concept} in your experience?\",\n                },\n                pace_considerations=\"Concrete examples slow down and deepen exploration\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.SOCRATIC,\n                category=\"assumptions\",\n                template=\"What are you assuming when you say {statement}?\",\n                when_to_use=\"When user makes a claim that rests on hidden assumptions\",\n                source=\"Paul & Elder (2006) - The Art of Socratic Questioning\",\n                directness_variants={\n                    \"direct\": \"What assumption underlies {statement}?\",\n                    \"balanced\": \"What are you assuming when you say {statement}?\",\n                    \"gentle\": \"I notice {statement} - what might you be taking for granted there?\",\n                },\n                pace_considerations=\"Uncovering assumptions can be destabilizing; proceed gently\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.SOCRATIC,\n                category=\"reasoning\",\n                template=\"How does {concept_a} relate to {concept_b}?\",\n                when_to_use=\"When exploring relationships between ideas\",\n                source=\"Paul & Elder (2006) - The Art of Socratic Questioning\",\n                directness_variants={\n                    \"direct\": \"What's the connection between {concept_a} and {concept_b}?\",\n                    \"balanced\": \"How does {concept_a} relate to {concept_b}?\",\n                    \"gentle\": \"I'm wondering about the relationship between {concept_a} and {concept_b}...\",\n                },\n                pace_considerations=\"Relationship questions invite systems thinking\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.SOCRATIC,\n                category=\"implications\",\n                template=\"If {statement} is true, what else would have to be true?\",\n                when_to_use=\"When testing logical consistency and exploring consequences\",\n                source=\"Paul & Elder (2006) - The Art of Socratic Questioning\",\n                directness_variants={\n                    \"direct\": \"What follows logically from {statement}?\",\n                    \"balanced\": \"If {statement} is true, what else would have to be true?\",\n                    \"gentle\": \"What might follow from {statement}, I wonder?\",\n                },\n                pace_considerations=\"Implication questions can reveal contradictions; allow processing time\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.SOCRATIC,\n                category=\"evidence\",\n                template=\"What leads you to believe {claim}?\",\n                when_to_use=\"When user makes a claim that needs grounding in evidence\",\n                source=\"Paul & Elder (2006) - The Art of Socratic Questioning\",\n                directness_variants={\n                    \"direct\": \"What evidence supports {claim}?\",\n                    \"balanced\": \"What leads you to believe {claim}?\",\n                    \"gentle\": \"I'm curious what makes {claim} seem true to you?\",\n                },\n                pace_considerations=\"Evidence questions ground abstract thinking\",\n            ),\n\n            # ============================================================\n            # SOLUTION-FOCUSED BRIEF THERAPY\n            # Source: De Jong & Berg (2013) \"Interviewing for Solutions\"\n            # ============================================================\n            QuestionTemplate(\n                approach=InquiryApproach.SOLUTION_FOCUSED,\n                category=\"opening\",\n                template=\"What would be different if this problem was solved?\",\n                when_to_use=\"Early in session to orient toward desired outcome\",\n                source=\"De Jong & Berg (2013) - Interviewing for Solutions\",\n                directness_variants={\n                    \"direct\": \"Describe what life looks like when this is solved.\",\n                    \"balanced\": \"What would be different if this problem was solved?\",\n                    \"gentle\": \"Imagine this gets better - what might change?\",\n                },\n                pace_considerations=\"Future-oriented questions create hope and direction\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.SOLUTION_FOCUSED,\n                category=\"exceptions\",\n                template=\"When is this problem less severe or absent?\",\n                when_to_use=\"When user is stuck in problem-saturated narrative\",\n                source=\"De Jong & Berg (2013) - Interviewing for Solutions\",\n                directness_variants={\n                    \"direct\": \"When doesn't this happen?\",\n                    \"balanced\": \"When is this problem less severe or absent?\",\n                    \"gentle\": \"Are there times when things feel a little easier?\",\n                },\n                pace_considerations=\"Exception questions reveal existing resources\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.SOLUTION_FOCUSED,\n                category=\"scaling\",\n                template=\"On a scale of 1-10, where 10 is {goal} fully achieved and 1 is the opposite, where are you now?\",\n                when_to_use=\"To establish baseline and track progress\",\n                source=\"De Jong & Berg (2013) - Interviewing for Solutions\",\n                directness_variants={\n                    \"direct\": \"Rate where you are: 1-10, where 10 is {goal} achieved.\",\n                    \"balanced\": \"On a scale of 1-10, where 10 is {goal} fully achieved, where are you?\",\n                    \"gentle\": \"If you had to guess, where might you be on a 1-10 scale toward {goal}?\",\n                },\n                pace_considerations=\"Scaling makes progress visible and concrete\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.SOLUTION_FOCUSED,\n                category=\"scaling\",\n                template=\"What would one point higher on the scale look like?\",\n                when_to_use=\"After establishing current position on scale\",\n                source=\"De Jong & Berg (2013) - Interviewing for Solutions\",\n                directness_variants={\n                    \"direct\": \"Describe what one point higher looks like.\",\n                    \"balanced\": \"What would one point higher on the scale look like?\",\n                    \"gentle\": \"What might be a small sign you'd moved up just one point?\",\n                },\n                pace_considerations=\"Small increment questions make change feel achievable\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.SOLUTION_FOCUSED,\n                category=\"coping\",\n                template=\"How have you managed to keep things from getting worse?\",\n                when_to_use=\"When user feels helpless or defeated\",\n                source=\"De Jong & Berg (2013) - Interviewing for Solutions\",\n                directness_variants={\n                    \"direct\": \"What's keeping this from getting worse?\",\n                    \"balanced\": \"How have you managed to keep things from getting worse?\",\n                    \"gentle\": \"I'm noticing you're still here, still trying - what's helped you keep going?\",\n                },\n                pace_considerations=\"Coping questions highlight resilience and agency\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.SOLUTION_FOCUSED,\n                category=\"resources\",\n                template=\"What resources or strengths have you used in similar situations?\",\n                when_to_use=\"When user needs reminder of past competence\",\n                source=\"De Jong & Berg (2013) - Interviewing for Solutions\",\n                directness_variants={\n                    \"direct\": \"What strengths can you draw on here?\",\n                    \"balanced\": \"What resources or strengths have you used in similar situations?\",\n                    \"gentle\": \"What's helped you through difficult times before?\",\n                },\n                pace_considerations=\"Resource questions activate existing capabilities\",\n            ),\n\n            # ============================================================\n            # PHENOMENOLOGICAL INQUIRY / FOCUSING\n            # Source: Gendlin (1982) \"Focusing\" and Cornell (2013) \"The Radical Acceptance of Everything\"\n            # ============================================================\n            QuestionTemplate(\n                approach=InquiryApproach.PHENOMENOLOGICAL,\n                category=\"grounding\",\n                template=\"What do you notice in your body as you say that?\",\n                when_to_use=\"When user is abstract or disconnected from felt experience\",\n                source=\"Gendlin (1982) - Focusing\",\n                directness_variants={\n                    \"direct\": \"Check your body - what's there?\",\n                    \"balanced\": \"What do you notice in your body as you say that?\",\n                    \"gentle\": \"If you tune into your body for a moment, what's present?\",\n                },\n                pace_considerations=\"Body questions require slowing down; allow 10-15 seconds\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.PHENOMENOLOGICAL,\n                category=\"deepening\",\n                template=\"Can you stay with that feeling for a moment and see what it wants to say?\",\n                when_to_use=\"When felt sense has emerged but not yet articulated\",\n                source=\"Gendlin (1982) - Focusing\",\n                directness_variants={\n                    \"direct\": \"Stay with that feeling - what does it want to say?\",\n                    \"balanced\": \"Can you stay with that feeling and see what it wants to say?\",\n                    \"gentle\": \"If that feeling could speak, what might it say?\",\n                },\n                pace_considerations=\"Staying with feelings is advanced; user needs capacity\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.PHENOMENOLOGICAL,\n                category=\"naming\",\n                template=\"What word or image captures the quality of {sensation}?\",\n                when_to_use=\"When helping user articulate vague bodily sense\",\n                source=\"Gendlin (1982) - Focusing\",\n                directness_variants={\n                    \"direct\": \"What word fits {sensation}?\",\n                    \"balanced\": \"What word or image captures the quality of {sensation}?\",\n                    \"gentle\": \"Is there a word or image that might fit {sensation}?\",\n                },\n                pace_considerations=\"Finding the right word creates 'felt shift' - be patient\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.PHENOMENOLOGICAL,\n                category=\"welcoming\",\n                template=\"Can you say hello to {feeling} and let it know you're here with it?\",\n                when_to_use=\"When user is resisting or fighting an emotion\",\n                source=\"Cornell (2013) - The Radical Acceptance of Everything\",\n                directness_variants={\n                    \"direct\": \"Acknowledge {feeling} - say hello to it.\",\n                    \"balanced\": \"Can you say hello to {feeling} and let it know you're here with it?\",\n                    \"gentle\": \"What if you could just be with {feeling}, without changing it?\",\n                },\n                pace_considerations=\"Radical acceptance approach - needs gentle, permissive framing\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.PHENOMENOLOGICAL,\n                category=\"checking\",\n                template=\"Does {word} feel right for what you're experiencing, or is there something more accurate?\",\n                when_to_use=\"After user has named an experience - verify the fit\",\n                source=\"Gendlin (1982) - Focusing\",\n                directness_variants={\n                    \"direct\": \"Is {word} the right word?\",\n                    \"balanced\": \"Does {word} feel right, or is there something more accurate?\",\n                    \"gentle\": \"How does {word} sit with you - does it fit?\",\n                },\n                pace_considerations=\"Checking creates precision and deeper contact with experience\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.PHENOMENOLOGICAL,\n                category=\"sensation\",\n                template=\"Where in your body do you feel {emotion}?\",\n                when_to_use=\"When user names emotion but stays cognitive\",\n                source=\"Gendlin (1982) - Focusing\",\n                directness_variants={\n                    \"direct\": \"Where is {emotion} in your body?\",\n                    \"balanced\": \"Where in your body do you feel {emotion}?\",\n                    \"gentle\": \"If you scan your body, where might {emotion} be showing up?\",\n                },\n                pace_considerations=\"Locating emotions in body creates embodied awareness\",\n            ),\n\n            # ============================================================\n            # SYSTEMS THINKING\n            # Source: Meadows (2008) \"Thinking in Systems\" and Senge (1990) \"The Fifth Discipline\"\n            # ============================================================\n            QuestionTemplate(\n                approach=InquiryApproach.SYSTEMS,\n                category=\"connections\",\n                template=\"How does changing {element_a} affect {element_b}?\",\n                when_to_use=\"When exploring relationships in a system\",\n                source=\"Meadows (2008) - Thinking in Systems\",\n                directness_variants={\n                    \"direct\": \"What's the causal link between {element_a} and {element_b}?\",\n                    \"balanced\": \"How does changing {element_a} affect {element_b}?\",\n                    \"gentle\": \"I'm curious about the connection between {element_a} and {element_b}...\",\n                },\n                pace_considerations=\"Causal questions invite complexity - allow thinking time\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.SYSTEMS,\n                category=\"feedback\",\n                template=\"What happens when {action} creates {result}, and then {result} influences {action}?\",\n                when_to_use=\"When identifying feedback loops\",\n                source=\"Meadows (2008) - Thinking in Systems\",\n                directness_variants={\n                    \"direct\": \"Trace the feedback loop: {action} → {result} → ?\",\n                    \"balanced\": \"What happens when {action} creates {result}, which then influences {action}?\",\n                    \"gentle\": \"It sounds like {action} and {result} might be influencing each other - how does that cycle work?\",\n                },\n                pace_considerations=\"Feedback loops are cognitively demanding - use visual aids if possible\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.SYSTEMS,\n                category=\"emergence\",\n                template=\"What patterns emerge when {elements} interact over time?\",\n                when_to_use=\"When exploring emergent properties of a system\",\n                source=\"Meadows (2008) - Thinking in Systems\",\n                directness_variants={\n                    \"direct\": \"What patterns do you see emerging from {elements}?\",\n                    \"balanced\": \"What patterns emerge when {elements} interact over time?\",\n                    \"gentle\": \"As you step back and look at {elements} together, what do you notice?\",\n                },\n                pace_considerations=\"Emergence requires zooming out - create spaciousness\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.SYSTEMS,\n                category=\"leverage\",\n                template=\"Where could a small change in {system} create a large effect?\",\n                when_to_use=\"When looking for high-leverage interventions\",\n                source=\"Meadows (2008) - Thinking in Systems\",\n                directness_variants={\n                    \"direct\": \"What's the leverage point in {system}?\",\n                    \"balanced\": \"Where could a small change create a large effect in {system}?\",\n                    \"gentle\": \"What's something small that might shift {system} in a big way?\",\n                },\n                pace_considerations=\"Leverage point questions focus energy efficiently\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.SYSTEMS,\n                category=\"boundaries\",\n                template=\"What are you including in {system} and what are you leaving out?\",\n                when_to_use=\"When system boundaries need examination\",\n                source=\"Meadows (2008) - Thinking in Systems\",\n                directness_variants={\n                    \"direct\": \"Define the boundaries of {system}.\",\n                    \"balanced\": \"What are you including in {system} and what are you leaving out?\",\n                    \"gentle\": \"How are you thinking about what's inside vs. outside {system}?\",\n                },\n                pace_considerations=\"Boundary questions reveal hidden assumptions\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.SYSTEMS,\n                category=\"delays\",\n                template=\"What delays exist between {action} and {outcome}?\",\n                when_to_use=\"When timing and delays are relevant\",\n                source=\"Senge (1990) - The Fifth Discipline\",\n                directness_variants={\n                    \"direct\": \"How long between {action} and {outcome}?\",\n                    \"balanced\": \"What delays exist between {action} and {outcome}?\",\n                    \"gentle\": \"How much time passes between {action} and seeing {outcome}?\",\n                },\n                pace_considerations=\"Delay awareness prevents premature conclusions\",\n            ),\n\n            # ============================================================\n            # METACOGNITIVE INQUIRY\n            # Source: Flavell (1979) and Schraw & Moshman (1995) on Metacognition\n            # ============================================================\n            QuestionTemplate(\n                approach=InquiryApproach.METACOGNITIVE,\n                category=\"reflection\",\n                template=\"How are you approaching this problem?\",\n                when_to_use=\"When user needs to step back from content to examine process\",\n                source=\"Flavell (1979) - Metacognition and cognitive monitoring\",\n                directness_variants={\n                    \"direct\": \"Describe your problem-solving approach.\",\n                    \"balanced\": \"How are you approaching this problem?\",\n                    \"gentle\": \"I'm curious about your thinking process here - what's your approach?\",\n                },\n                pace_considerations=\"Metacognitive questions create healthy distance\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.METACOGNITIVE,\n                category=\"assumptions\",\n                template=\"What assumptions are you making about {situation}?\",\n                when_to_use=\"When hidden assumptions may be constraining thinking\",\n                source=\"Schraw & Moshman (1995) - Metacognitive theories\",\n                directness_variants={\n                    \"direct\": \"List your assumptions about {situation}.\",\n                    \"balanced\": \"What assumptions are you making about {situation}?\",\n                    \"gentle\": \"What might you be taking for granted about {situation}?\",\n                },\n                pace_considerations=\"Surfacing assumptions can be destabilizing - proceed gently\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.METACOGNITIVE,\n                category=\"perspective\",\n                template=\"What would you tell a friend who came to you with this situation?\",\n                when_to_use=\"When user needs distance from their own situation\",\n                source=\"Cognitive therapy tradition - self-distancing technique\",\n                directness_variants={\n                    \"direct\": \"Advise yourself as if you were someone else.\",\n                    \"balanced\": \"What would you tell a friend facing this situation?\",\n                    \"gentle\": \"If a good friend told you about this, what might you say to them?\",\n                },\n                pace_considerations=\"Third-person perspective creates helpful objectivity\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.METACOGNITIVE,\n                category=\"monitoring\",\n                template=\"How confident are you in {conclusion}?\",\n                when_to_use=\"When calibrating certainty and identifying knowledge gaps\",\n                source=\"Schraw & Moshman (1995) - Metacognitive theories\",\n                directness_variants={\n                    \"direct\": \"Rate your confidence in {conclusion}: 1-10.\",\n                    \"balanced\": \"How confident are you in {conclusion}?\",\n                    \"gentle\": \"How sure do you feel about {conclusion}?\",\n                },\n                pace_considerations=\"Confidence calibration prevents overcommitment\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.METACOGNITIVE,\n                category=\"strategy\",\n                template=\"Is this thinking strategy working, or do you need to try something different?\",\n                when_to_use=\"When user seems stuck in unproductive pattern\",\n                source=\"Flavell (1979) - Metacognition and cognitive monitoring\",\n                directness_variants={\n                    \"direct\": \"This approach isn't working - what else could you try?\",\n                    \"balanced\": \"Is this strategy working, or should you try something different?\",\n                    \"gentle\": \"How is this approach feeling - helpful, or time for something new?\",\n                },\n                pace_considerations=\"Strategy evaluation prevents perseveration\",\n            ),\n            QuestionTemplate(\n                approach=InquiryApproach.METACOGNITIVE,\n                category=\"learning\",\n                template=\"What are you learning about how you think through {domain}?\",\n                when_to_use=\"When highlighting patterns in user's thinking process\",\n                source=\"Schraw & Moshman (1995) - Metacognitive theories\",\n                directness_variants={\n                    \"direct\": \"What patterns do you notice in how you think about {domain}?\",\n                    \"balanced\": \"What are you learning about how you think through {domain}?\",\n                    \"gentle\": \"As you explore {domain}, what do you notice about your thinking?\",\n                },\n                pace_considerations=\"Meta-learning questions build self-awareness over time\",\n            ),\n        ]\n\n    def get_templates_for_approach(\n        self, approach: InquiryApproach, category: str | None = None\n    ) -> list[QuestionTemplate]:\n        \"\"\"Get all templates for a specific approach, optionally filtered by category.\n\n        Args:\n            approach: The inquiry approach to filter by\n            category: Optional category to further filter (e.g., \"clarifying\", \"deepening\")\n\n        Returns:\n            List of matching question templates\n        \"\"\"\n        templates = [t for t in self._templates if t.approach == approach]\n\n        if category:\n            templates = [t for t in templates if t.category == category]\n\n        return templates\n\n    def get_template_by_criteria(\n        self, approach: InquiryApproach, category: str, context: str\n    ) -> QuestionTemplate | None:\n        \"\"\"Get a specific template matching approach, category, and context keywords.\n\n        Args:\n            approach: The inquiry approach\n            category: The template category\n            context: Context string to match against when_to_use\n\n        Returns:\n            Matching template or None\n        \"\"\"\n        candidates = self.get_templates_for_approach(approach, category)\n\n        # Simple keyword matching in when_to_use field\n        context_lower = context.lower()\n        for template in candidates:\n            if any(\n                keyword in context_lower\n                for keyword in template.when_to_use.lower().split()\n            ):\n                return template\n\n        # Return first matching category if no context match\n        return candidates[0] if candidates else None\n\n    def adapt_template(\n        self,\n        template: QuestionTemplate,\n        directness: str = \"balanced\",\n        placeholders: dict[str, Any] | None = None,\n    ) -> str:\n        \"\"\"Adapt a template to profile settings and fill in placeholders.\n\n        Args:\n            template: The template to adapt\n            directness: Profile directness setting (direct/balanced/gentle)\n            placeholders: Dictionary of placeholder values to fill in template\n\n        Returns:\n            Adapted and filled question string\n        \"\"\"\n        # Get directness variant or fall back to default template\n        question = template.directness_variants.get(directness, template.template)\n\n        # Fill in placeholders if provided\n        if placeholders:\n            try:\n                question = question.format(**placeholders)\n            except KeyError as e:\n                # If placeholder is missing, return template with unfilled placeholders\n                # This is acceptable - AI can fill them contextually\n                pass\n\n        return question\n\n    def generate_question_batch(\n        self,\n        approach: InquiryApproach,\n        state: UserState,\n        context: str,\n        directness: str = \"balanced\",\n        abstraction: str = \"mixed\",\n        count: int = 3,\n    ) -> QuestionBatch:\n        \"\"\"Generate a batch of questions for a given state and approach.\n\n        Args:\n            approach: The inquiry approach to use\n            state: The detected user state\n            context: Current conversation context\n            directness: Profile directness setting\n            abstraction: Profile abstraction preference\n            count: Number of questions to generate\n\n        Returns:\n            QuestionBatch with adapted questions\n        \"\"\"\n        templates = self.get_templates_for_approach(approach)\n\n        # Select diverse templates (different categories)\n        selected_templates: list[QuestionTemplate] = []\n        categories_used: set[str] = set()\n\n        for template in templates:\n            if template.category not in categories_used:\n                selected_templates.append(template)\n                categories_used.add(template.category)\n                if len(selected_templates) >= count:\n                    break\n\n        # If we don't have enough unique categories, add more from any category\n        if len(selected_templates) < count:\n            for template in templates:\n                if template not in selected_templates:\n                    selected_templates.append(template)\n                    if len(selected_templates) >= count:\n                        break\n\n        # Adapt templates to profile settings\n        questions = [\n            self.adapt_template(template, directness=directness)\n            for template in selected_templates\n        ]\n\n        adaptations = [f\"directness={directness}\"]\n        if abstraction != \"mixed\":\n            adaptations.append(f\"abstraction={abstraction}\")\n\n        return QuestionBatch(\n            approach=approach,\n            state=state,\n            questions=questions,\n            context=context,\n            profile_adaptations_applied=adaptations,\n        )\n\n    def get_approach_description(self, approach: InquiryApproach) -> str:\n        \"\"\"Get a description of an inquiry approach.\n\n        Args:\n            approach: The inquiry approach\n\n        Returns:\n            Description string for system prompts\n        \"\"\"\n        from ies_backend.schemas.question_engine import APPROACH_DESCRIPTIONS\n\n        return APPROACH_DESCRIPTIONS.get(\n            approach, \"No description available for this approach.\"\n        )\n\n    def get_all_approaches(self) -> list[InquiryApproach]:\n        \"\"\"Get list of all inquiry approaches that have templates.\n\n        Returns:\n            List of InquiryApproach values with templates\n        \"\"\"\n        approaches = {t.approach for t in self._templates}\n        return sorted(approaches, key=lambda a: a.value)\n\n    def get_categories_for_approach(self, approach: InquiryApproach) -> list[str]:\n        \"\"\"Get all categories available for an approach.\n\n        Args:\n            approach: The inquiry approach\n\n        Returns:\n            List of category names\n        \"\"\"\n        categories = {\n            t.category for t in self._templates if t.approach == approach\n        }\n        return sorted(categories)\n\n    def get_template_count(self, approach: InquiryApproach | None = None) -> int:\n        \"\"\"Get count of templates, optionally filtered by approach.\n\n        Args:\n            approach: Optional approach to filter by\n\n        Returns:\n            Number of templates\n        \"\"\"\n        if approach:\n            return len([t for t in self._templates if t.approach == approach])\n        return len(self._templates)\n\n\n# Singleton instance\nquestion_templates_service = QuestionTemplatesService()\n"
    }
  }
]

---

### User
> 12/1/2025, 2:44:39 PM

[
  {
    "tool_use_id": "toolu_01Vi3STuryr4A84ZcCubmkmt",
    "type": "tool_result",
    "content": "The file /home/chris/dev/projects/codex/brain_explore/ies-backend/src/ies_backend/services/question_templates_service.py has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n     1→\"\"\"Question Templates Service for the Intelligent Exploration System.\n     2→\n     3→This service provides research-backed question templates from therapy and coaching literature,\n     4→organized by inquiry approach and adapted to user profile settings.\n     5→\"\"\"\n     6→\n     7→from typing import Any\n     8→\n     9→from ies_backend.schemas.question_engine import (\n    10→    InquiryApproach,\n    11→    QuestionBatch,\n    12→    QuestionTemplate,\n    13→    UserState,\n    14→)\n    15→\n    16→\n    17→class QuestionTemplatesService:\n    18→    \"\"\"Service for managing and retrieving question templates.\"\"\"\n    19→\n    20→    def __init__(self) -> None:\n    21→        \"\"\"Initialize the service with template library.\"\"\"\n    22→        self._templates: list[QuestionTemplate] = self._build_template_library()\n    23→\n    24→    def _build_template_library(self) -> list[QuestionTemplate]:\n    25→        \"\"\"Build the complete template library from therapy/coaching literature.\"\"\"\n    26→        return [\n    27→            # ============================================================\n    28→            # SOCRATIC INQUIRY\n    29→            # Source: Paul & Elder (2006) \"The Thinker's Guide to The Art of Socratic Questioning\"\n    30→            # ============================================================\n    31→            QuestionTemplate(\n    32→                approach=InquiryApproach.SOCRATIC,\n    33→                category=\"clarifying\",\n    34→                template=\"What do you mean when you say '{concept}'?\",\n    35→                when_to_use=\"When user uses an undefined or ambiguous term\",\n    36→                source=\"Paul & Elder (2006) - The Art of Socratic Questioning\",\n    37→                directness_variants={\n    38→                    \"direct\": \"Define what you mean by '{concept}'.\",\n    39→                    \"balanced\": \"What do you mean when you say '{concept}'?\",\n    40→                    \"gentle\": \"I'm curious what '{concept}' means to you - could you say more?\",\n    41→                },\n    42→                pace_considerations=\"Allow time for reflection; this question often reveals hidden complexity\",\n    43→            ),\n    44→            QuestionTemplate(\n    45→                approach=InquiryApproach.SOCRATIC,\n    46→                category=\"clarifying\",\n    47→                template=\"Can you give me an example of {concept}?\",\n    48→                when_to_use=\"When abstract concept needs grounding in concrete experience\",\n    49→                source=\"Paul & Elder (2006) - The Art of Socratic Questioning\",\n    50→                directness_variants={\n    51→                    \"direct\": \"Give me a specific example of {concept}.\",\n    52→                    \"balanced\": \"Can you give me an example of {concept}?\",\n    53→                    \"gentle\": \"What might be an example of {concept} in your experience?\",\n    54→                },\n    55→                pace_considerations=\"Concrete examples slow down and deepen exploration\",\n    56→            ),\n    57→            QuestionTemplate(\n    58→                approach=InquiryApproach.SOCRATIC,\n    59→                category=\"assumptions\",\n    60→                template=\"What are you assuming when you say {statement}?\",\n    61→                when_to_use=\"When user makes a claim that rests on hidden assumptions\",\n    62→                source=\"Paul & Elder (2006) - The Art of Socratic Questioning\",\n    63→                directness_variants={\n    64→                    \"direct\": \"What assumption underlies {statement}?\",\n    65→                    \"balanced\": \"What are you assuming when you say {statement}?\",\n    66→                    \"gentle\": \"I notice {statement} - what might you be taking for granted there?\",\n    67→                },\n    68→                pace_considerations=\"Uncovering assumptions can be destabilizing; proceed gently\",\n    69→            ),\n    70→            QuestionTemplate(\n    71→                approach=InquiryApproach.SOCRATIC,\n    72→                category=\"reasoning\",\n    73→                template=\"How does {concept_a} relate to {concept_b}?\",\n    74→                when_to_use=\"When exploring relationships between ideas\",\n    75→                source=\"Paul & Elder (2006) - The Art of Socratic Questioning\",\n    76→                directness_variants={\n    77→                    \"direct\": \"What's the connection between {concept_a} and {concept_b}?\",\n    78→                    \"balanced\": \"How does {concept_a} relate to {concept_b}?\",\n    79→                    \"gentle\": \"I'm wondering about the relationship between {concept_a} and {concept_b}...\",\n    80→                },\n    81→                pace_considerations=\"Relationship questions invite systems thinking\",\n    82→            ),\n    83→            QuestionTemplate(\n    84→                approach=InquiryApproach.SOCRATIC,\n    85→                category=\"implications\",\n    86→                template=\"If {statement} is true, what else would have to be true?\",\n    87→                when_to_use=\"When testing logical consistency and exploring consequences\",\n    88→                source=\"Paul & Elder (2006) - The Art of Socratic Questioning\",\n    89→                directness_variants={\n    90→                    \"direct\": \"What follows logically from {statement}?\",\n    91→                    \"balanced\": \"If {statement} is true, what else would have to be true?\",\n    92→                    \"gentle\": \"What might follow from {statement}, I wonder?\",\n    93→                },\n    94→                pace_considerations=\"Implication questions can reveal contradictions; allow processing time\",\n    95→            ),\n    96→            QuestionTemplate(\n    97→                approach=InquiryApproach.SOCRATIC,\n    98→                category=\"evidence\",\n    99→                template=\"What leads you to believe {claim}?\",\n   100→                when_to_use=\"When user makes a claim that needs grounding in evidence\",\n   101→                source=\"Paul & Elder (2006) - The Art of Socratic Questioning\",\n   102→                directness_variants={\n   103→                    \"direct\": \"What evidence supports {claim}?\",\n   104→                    \"balanced\": \"What leads you to believe {claim}?\",\n   105→                    \"gentle\": \"I'm curious what makes {claim} seem true to you?\",\n   106→                },\n   107→                pace_considerations=\"Evidence questions ground abstract thinking\",\n   108→            ),\n   109→\n   110→            # ============================================================\n   111→            # SOLUTION-FOCUSED BRIEF THERAPY\n   112→            # Source: De Jong & Berg (2013) \"Interviewing for Solutions\"\n   113→            # ============================================================\n   114→            QuestionTemplate(\n   115→                approach=InquiryApproach.SOLUTION_FOCUSED,\n   116→                category=\"opening\",\n   117→                template=\"What would be different if this problem was solved?\",\n   118→                when_to_use=\"Early in session to orient toward desired outcome\",\n   119→                source=\"De Jong & Berg (2013) - Interviewing for Solutions\",\n   120→                directness_variants={\n   121→                    \"direct\": \"Describe what life looks like when this is solved.\",\n   122→                    \"balanced\": \"What would be different if this problem was solved?\",\n   123→                    \"gentle\": \"Imagine this gets better - what might change?\",\n   124→                },\n   125→                pace_considerations=\"Future-oriented questions create hope and direction\",\n   126→            ),\n   127→            QuestionTemplate(\n   128→                approach=InquiryApproach.SOLUTION_FOCUSED,\n   129→                category=\"exceptions\",\n   130→                template=\"When is this problem less severe or absent?\",\n   131→                when_to_use=\"When user is stuck in problem-saturated narrative\",\n   132→                source=\"De Jong & Berg (2013) - Interviewing for Solutions\",\n   133→                directness_variants={\n   134→                    \"direct\": \"When doesn't this happen?\",\n   135→                    \"balanced\": \"When is this problem less severe or absent?\",\n   136→                    \"gentle\": \"Are there times when things feel a little easier?\",\n   137→                },\n   138→                pace_considerations=\"Exception questions reveal existing resources\",\n   139→            ),\n   140→            QuestionTemplate(\n   141→                approach=InquiryApproach.SOLUTION_FOCUSED,\n   142→                category=\"scaling\",\n   143→                template=\"On a scale of 1-10, where 10 is {goal} fully achieved and 1 is the opposite, where are you now?\",\n   144→                when_to_use=\"To establish baseline and track progress\",\n   145→                source=\"De Jong & Berg (2013) - Interviewing for Solutions\",\n   146→                directness_variants={\n   147→                    \"direct\": \"Rate where you are: 1-10, where 10 is {goal} achieved.\",\n   148→                    \"balanced\": \"On a scale of 1-10, where 10 is {goal} fully achieved, where are you?\",\n   149→                    \"gentle\": \"If you had to guess, where might you be on a 1-10 scale toward {goal}?\",\n   150→                },\n   151→                pace_considerations=\"Scaling makes progress visible and concrete\",\n   152→            ),\n   153→            QuestionTemplate(\n   154→                approach=InquiryApproach.SOLUTION_FOCUSED,\n   155→                category=\"scaling\",\n   156→                template=\"What would one point higher on the scale look like?\",\n   157→                when_to_use=\"After establishing current position on scale\",\n   158→                source=\"De Jong & Berg (2013) - Interviewing for Solutions\",\n   159→                directness_variants={\n   160→                    \"direct\": \"Describe what one point higher looks like.\",\n   161→                    \"balanced\": \"What would one point higher on the scale look like?\",\n   162→                    \"gentle\": \"What might be a small sign you'd moved up just one point?\",\n   163→                },\n   164→                pace_considerations=\"Small increment questions make change feel achievable\",\n   165→            ),\n   166→            QuestionTemplate(\n   167→                approach=InquiryApproach.SOLUTION_FOCUSED,\n   168→                category=\"coping\",\n   169→                template=\"How have you managed to keep things from getting worse?\",\n   170→                when_to_use=\"When user feels helpless or defeated\",\n   171→                source=\"De Jong & Berg (2013) - Interviewing for Solutions\",\n   172→                directness_variants={\n   173→                    \"direct\": \"What's keeping this from getting worse?\",\n   174→                    \"balanced\": \"How have you managed to keep things from getting worse?\",\n   175→                    \"gentle\": \"I'm noticing you're still here, still trying - what's helped you keep going?\",\n   176→                },\n   177→                pace_considerations=\"Coping questions highlight resilience and agency\",\n   178→            ),\n   179→            QuestionTemplate(\n   180→                approach=InquiryApproach.SOLUTION_FOCUSED,\n   181→                category=\"resources\",\n   182→                template=\"What resources or strengths have you used in similar situations?\",\n   183→                when_to_use=\"When user needs reminder of past competence\",\n   184→                source=\"De Jong & Berg (2013) - Interviewing for Solutions\",\n   185→                directness_variants={\n   186→                    \"direct\": \"What strengths can you draw on here?\",\n   187→                    \"balanced\": \"What resources or strengths have you used in similar situations?\",\n   188→                    \"gentle\": \"What's helped you through difficult times before?\",\n   189→                },\n   190→                pace_considerations=\"Resource questions activate existing capabilities\",\n   191→            ),\n   192→\n   193→            # ============================================================\n   194→            # PHENOMENOLOGICAL INQUIRY / FOCUSING\n   195→            # Source: Gendlin (1982) \"Focusing\" and Cornell (2013) \"The Radical Acceptance of Everything\"\n   196→            # ============================================================\n   197→            QuestionTemplate(\n   198→                approach=InquiryApproach.PHENOMENOLOGICAL,\n   199→                category=\"grounding\",\n   200→                template=\"What do you notice in your body as you say that?\",\n   201→                when_to_use=\"When user is abstract or disconnected from felt experience\",\n   202→                source=\"Gendlin (1982) - Focusing\",\n   203→                directness_variants={\n   204→                    \"direct\": \"Check your body - what's there?\",\n   205→                    \"balanced\": \"What do you notice in your body as you say that?\",\n   206→                    \"gentle\": \"If you tune into your body for a moment, what's present?\",\n   207→                },\n   208→                pace_considerations=\"Body questions require slowing down; allow 10-15 seconds\",\n   209→            ),\n   210→            QuestionTemplate(\n   211→                approach=InquiryApproach.PHENOMENOLOGICAL,\n   212→                category=\"deepening\",\n   213→                template=\"Can you stay with that feeling for a moment and see what it wants to say?\",\n   214→                when_to_use=\"When felt sense has emerged but not yet articulated\",\n   215→                source=\"Gendlin (1982) - Focusing\",\n   216→                directness_variants={\n   217→                    \"direct\": \"Stay with that feeling - what does it want to say?\",\n   218→                    \"balanced\": \"Can you stay with that feeling and see what it wants to say?\",\n   219→                    \"gentle\": \"If that feeling could speak, what might it say?\",\n   220→                },\n   221→                pace_considerations=\"Staying with feelings is advanced; user needs capacity\",\n   222→            ),\n   223→            QuestionTemplate(\n   224→                approach=InquiryApproach.PHENOMENOLOGICAL,\n   225→                category=\"naming\",\n   226→                template=\"What word or image captures the quality of {sensation}?\",\n   227→                when_to_use=\"When helping user articulate vague bodily sense\",\n   228→                source=\"Gendlin (1982) - Focusing\",\n   229→                directness_variants={\n   230→                    \"direct\": \"What word fits {sensation}?\",\n   231→                    \"balanced\": \"What word or image captures the quality of {sensation}?\",\n   232→                    \"gentle\": \"Is there a word or image that might fit {sensation}?\",\n   233→                },\n   234→                pace_considerations=\"Finding the right word creates 'felt shift' - be patient\",\n   235→            ),\n   236→            QuestionTemplate(\n   237→                approach=InquiryApproach.PHENOMENOLOGICAL,\n   238→                category=\"welcoming\",\n   239→                template=\"Can you say hello to {feeling} and let it know you're here with it?\",\n   240→                when_to_use=\"When user is resisting or fighting an emotion\",\n   241→                source=\"Cornell (2013) - The Radical Acceptance of Everything\",\n   242→                directness_variants={\n   243→                    \"direct\": \"Acknowledge {feeling} - say hello to it.\",\n   244→                    \"balanced\": \"Can you say hello to {feeling} and let it know you're here with it?\",\n   245→                    \"gentle\": \"What if you could just be with {feeling}, without changing it?\",\n   246→                },\n   247→                pace_considerations=\"Radical acceptance approach - needs gentle, permissive framing\",\n   248→            ),\n   249→            QuestionTemplate(\n   250→                approach=InquiryApproach.PHENOMENOLOGICAL,\n   251→                category=\"checking\",\n   252→                template=\"Does {word} feel right for what you're experiencing, or is there something more accurate?\",\n   253→                when_to_use=\"After user has named an experience - verify the fit\",\n   254→                source=\"Gendlin (1982) - Focusing\",\n   255→                directness_variants={\n   256→                    \"direct\": \"Is {word} the right word?\",\n   257→                    \"balanced\": \"Does {word} feel right, or is there something more accurate?\",\n   258→                    \"gentle\": \"How does {word} sit with you - does it fit?\",\n   259→                },\n   260→                pace_considerations=\"Checking creates precision and deeper contact with experience\",\n   261→            ),\n   262→            QuestionTemplate(\n   263→                approach=InquiryApproach.PHENOMENOLOGICAL,\n   264→                category=\"sensation\",\n   265→                template=\"Where in your body do you feel {emotion}?\",\n   266→                when_to_use=\"When user names emotion but stays cognitive\",\n   267→                source=\"Gendlin (1982) - Focusing\",\n   268→                directness_variants={\n   269→                    \"direct\": \"Where is {emotion} in your body?\",\n   270→                    \"balanced\": \"Where in your body do you feel {emotion}?\",\n   271→                    \"gentle\": \"If you scan your body, where might {emotion} be showing up?\",\n   272→                },\n   273→                pace_considerations=\"Locating emotions in body creates embodied awareness\",\n   274→            ),\n   275→\n   276→            # ============================================================\n   277→            # SYSTEMS THINKING\n   278→            # Source: Meadows (2008) \"Thinking in Systems\" and Senge (1990) \"The Fifth Discipline\"\n   279→            # ============================================================\n   280→            QuestionTemplate(\n   281→                approach=InquiryApproach.SYSTEMS,\n   282→                category=\"connections\",\n   283→                template=\"How does changing {element_a} affect {element_b}?\",\n   284→                when_to_use=\"When exploring relationships in a system\",\n   285→                source=\"Meadows (2008) - Thinking in Systems\",\n   286→                directness_variants={\n   287→                    \"direct\": \"What's the causal link between {element_a} and {element_b}?\",\n   288→                    \"balanced\": \"How does changing {element_a} affect {element_b}?\",\n   289→                    \"gentle\": \"I'm curious about the connection between {element_a} and {element_b}...\",\n   290→                },\n   291→                pace_considerations=\"Causal questions invite complexity - allow thinking time\",\n   292→            ),\n   293→            QuestionTemplate(\n   294→                approach=InquiryApproach.SYSTEMS,\n   295→                category=\"feedback\",\n   296→                template=\"What happens when {action} creates {result}, and then {result} influences {action}?\",\n   297→                when_to_use=\"When identifying feedback loops\",\n   298→                source=\"Meadows (2008) - Thinking in Systems\",\n   299→                directness_variants={\n   300→                    \"direct\": \"Trace the feedback loop: {action} → {result} → ?\",\n   301→                    \"balanced\": \"What happens when {action} creates {result}, which then influences {action}?\",\n   302→                    \"gentle\": \"It sounds like {action} and {result} might be influencing each other - how does that cycle work?\",\n   303→                },\n   304→                pace_considerations=\"Feedback loops are cognitively demanding - use visual aids if possible\",\n   305→            ),\n   306→            QuestionTemplate(\n   307→                approach=InquiryApproach.SYSTEMS,\n   308→                category=\"emergence\",\n   309→                template=\"What patterns emerge when {elements} interact over time?\",\n   310→                when_to_use=\"When exploring emergent properties of a system\",\n   311→                source=\"Meadows (2008) - Thinking in Systems\",\n   312→                directness_variants={\n   313→                    \"direct\": \"What patterns do you see emerging from {elements}?\",\n   314→                    \"balanced\": \"What patterns emerge when {elements} interact over time?\",\n   315→                    \"gentle\": \"As you step back and look at {elements} together, what do you notice?\",\n   316→                },\n   317→                pace_considerations=\"Emergence requires zooming out - create spaciousness\",\n   318→            ),\n   319→            QuestionTemplate(\n   320→                approach=InquiryApproach.SYSTEMS,\n   321→                category=\"leverage\",\n   322→                template=\"Where could a small change in {system} create a large effect?\",\n   323→                when_to_use=\"When looking for high-leverage interventions\",\n   324→                source=\"Meadows (2008) - Thinking in Systems\",\n   325→                directness_variants={\n   326→                    \"direct\": \"What's the leverage point in {system}?\",\n   327→                    \"balanced\": \"Where could a small change create a large effect in {system}?\",\n   328→                    \"gentle\": \"What's something small that might shift {system} in a big way?\",\n   329→                },\n   330→                pace_considerations=\"Leverage point questions focus energy efficiently\",\n   331→            ),\n   332→            QuestionTemplate(\n   333→                approach=InquiryApproach.SYSTEMS,\n   334→                category=\"boundaries\",\n   335→                template=\"What are you including in {system} and what are you leaving out?\",\n   336→                when_to_use=\"When system boundaries need examination\",\n   337→                source=\"Meadows (2008) - Thinking in Systems\",\n   338→                directness_variants={\n   339→                    \"direct\": \"Define the boundaries of {system}.\",\n   340→                    \"balanced\": \"What are you including in {system} and what are you leaving out?\",\n   341→                    \"gentle\": \"How are you thinking about what's inside vs. outside {system}?\",\n   342→                },\n   343→                pace_considerations=\"Boundary questions reveal hidden assumptions\",\n   344→            ),\n   345→            QuestionTemplate(\n   346→                approach=InquiryApproach.SYSTEMS,\n   347→                category=\"delays\",\n   348→                template=\"What delays exist between {action} and {outcome}?\",\n   349→                when_to_use=\"When timing and delays are relevant\",\n   350→                source=\"Senge (1990) - The Fifth Discipline\",\n   351→                directness_variants={\n   352→                    \"direct\": \"How long between {action} and {outcome}?\",\n   353→                    \"balanced\": \"What delays exist between {action} and {outcome}?\",\n   354→                    \"gentle\": \"How much time passes between {action} and seeing {outcome}?\",\n   355→                },\n   356→                pace_considerations=\"Delay awareness prevents premature conclusions\",\n   357→            ),\n   358→\n   359→            # ============================================================\n   360→            # METACOGNITIVE INQUIRY\n   361→            # Source: Flavell (1979) and Schraw & Moshman (1995) on Metacognition\n   362→            # ============================================================\n   363→            QuestionTemplate(\n   364→                approach=InquiryApproach.METACOGNITIVE,\n   365→                category=\"reflection\",\n   366→                template=\"How are you approaching this problem?\",\n   367→                when_to_use=\"When user needs to step back from content to examine process\",\n   368→                source=\"Flavell (1979) - Metacognition and cognitive monitoring\",\n   369→                directness_variants={\n   370→                    \"direct\": \"Describe your problem-solving approach.\",\n   371→                    \"balanced\": \"How are you approaching this problem?\",\n   372→                    \"gentle\": \"I'm curious about your thinking process here - what's your approach?\",\n   373→                },\n   374→                pace_considerations=\"Metacognitive questions create healthy distance\",\n   375→            ),\n   376→            QuestionTemplate(\n   377→                approach=InquiryApproach.METACOGNITIVE,\n   378→                category=\"assumptions\",\n   379→                template=\"What assumptions are you making about {situation}?\",\n   380→                when_to_use=\"When hidden assumptions may be constraining thinking\",\n   381→                source=\"Schraw & Moshman (1995) - Metacognitive theories\",\n   382→                directness_variants={\n   383→                    \"direct\": \"List your assumptions about {situation}.\",\n   384→                    \"balanced\": \"What assumptions are you making about {situation}?\",\n   385→                    \"gentle\": \"What might you be taking for granted about {situation}?\",\n   386→                },\n   387→                pace_considerations=\"Surfacing assumptions can be destabilizing - proceed gently\",\n   388→            ),\n   389→            QuestionTemplate(\n   390→                approach=InquiryApproach.METACOGNITIVE,\n   391→                category=\"perspective\",\n   392→                template=\"What would you tell a friend who came to you with this situation?\",\n   393→                when_to_use=\"When user needs distance from their own situation\",\n   394→                source=\"Cognitive therapy tradition - self-distancing technique\",\n   395→                directness_variants={\n   396→                    \"direct\": \"Advise yourself as if you were someone else.\",\n   397→                    \"balanced\": \"What would you tell a friend facing this situation?\",\n   398→                    \"gentle\": \"If a good friend told you about this, what might you say to them?\",\n   399→                },\n   400→                pace_considerations=\"Third-person perspective creates helpful objectivity\",\n   401→            ),\n   402→            QuestionTemplate(\n   403→                approach=InquiryApproach.METACOGNITIVE,\n   404→                category=\"monitoring\",\n   405→                template=\"How confident are you in {conclusion}?\",\n   406→                when_to_use=\"When calibrating certainty and identifying knowledge gaps\",\n   407→                source=\"Schraw & Moshman (1995) - Metacognitive theories\",\n   408→                directness_variants={\n   409→                    \"direct\": \"Rate your confidence in {conclusion}: 1-10.\",\n   410→                    \"balanced\": \"How confident are you in {conclusion}?\",\n   411→                    \"gentle\": \"How sure do you feel about {conclusion}?\",\n   412→                },\n   413→                pace_considerations=\"Confidence calibration prevents overcommitment\",\n   414→            ),\n   415→            QuestionTemplate(\n   416→                approach=InquiryApproach.METACOGNITIVE,\n   417→                category=\"strategy\",\n   418→                template=\"Is this thinking strategy working, or do you need to try something different?\",\n   419→                when_to_use=\"When user seems stuck in unproductive pattern\",\n   420→                source=\"Flavell (1979) - Metacognition and cognitive monitoring\",\n   421→                directness_variants={\n   422→                    \"direct\": \"This approach isn't working - what else could you try?\",\n   423→                    \"balanced\": \"Is this strategy working, or should you try something different?\",\n   424→                    \"gentle\": \"How is this approach feeling - helpful, or time for something new?\",\n   425→                },\n   426→                pace_considerations=\"Strategy evaluation prevents perseveration\",\n   427→            ),\n   428→            QuestionTemplate(\n   429→                approach=InquiryApproach.METACOGNITIVE,\n   430→                category=\"learning\",\n   431→                template=\"What are you learning about how you think through {domain}?\",\n   432→                when_to_use=\"When highlighting patterns in user's thinking process\",\n   433→                source=\"Schraw & Moshman (1995) - Metacognitive theories\",\n   434→                directness_variants={\n   435→                    \"direct\": \"What patterns do you notice in how you think about {domain}?\",\n   436→                    \"balanced\": \"What are you learning about how you think through {domain}?\",\n   437→                    \"gentle\": \"As you explore {domain}, what do you notice about your thinking?\",\n   438→                },\n   439→                pace_considerations=\"Meta-learning questions build self-awareness over time\",\n   440→            ),\n   441→        ]\n   442→\n   443→    def get_templates_for_approach(\n   444→        self, approach: InquiryApproach, category: str | None = None\n   445→    ) -> list[QuestionTemplate]:\n   446→        \"\"\"Get all templates for a specific approach, optionally filtered by category.\n   447→\n   448→        Args:\n   449→            approach: The inquiry approach to filter by\n   450→            category: Optional category to further filter (e.g., \"clarifying\", \"deepening\")\n   451→\n   452→        Returns:\n   453→            List of matching question templates\n   454→        \"\"\"\n   455→        templates = [t for t in self._templates if t.approach == approach]\n   456→\n   457→        if category:\n   458→            templates = [t for t in templates if t.category == category]\n   459→\n   460→        return templates\n   461→\n   462→    def get_template_by_criteria(\n   463→        self, approach: InquiryApproach, category: str, context: str\n   464→    ) -> QuestionTemplate | None:\n   465→        \"\"\"Get a specific template matching approach, category, and context keywords.\n   466→\n   467→        Args:\n   468→            approach: The inquiry approach\n   469→            category: The template category\n   470→            context: Context string to match against when_to_use\n   471→\n   472→        Returns:\n   473→            Matching template or None\n   474→        \"\"\"\n   475→        candidates = self.get_templates_for_approach(approach, category)\n   476→\n   477→        # Simple keyword matching in when_to_use field\n   478→        context_lower = context.lower()\n   479→        for template in candidates:\n   480→            if any(\n   481→                keyword in context_lower\n   482→                for keyword in template.when_to_use.lower().split()\n   483→            ):\n   484→                return template\n   485→\n   486→        # Return first matching category if no context match\n   487→        return candidates[0] if candidates else None\n   488→\n   489→    def adapt_template(\n   490→        self,\n   491→        template: QuestionTemplate,\n   492→        directness: str = \"balanced\",\n   493→        placeholders: dict[str, Any] | None = None,\n   494→    ) -> str:\n   495→        \"\"\"Adapt a template to profile settings and fill in placeholders.\n   496→\n   497→        Args:\n   498→            template: The template to adapt\n   499→            directness: Profile directness setting (direct/balanced/gentle)\n   500→            placeholders: Dictionary of placeholder values to fill in template\n   501→\n   502→        Returns:\n   503→            Adapted and filled question string\n   504→        \"\"\"\n   505→        # Get directness variant or fall back to default template\n   506→        question = template.directness_variants.get(directness, template.template)\n   507→\n   508→        # Fill in placeholders if provided\n   509→        if placeholders:\n   510→            try:\n   511→                question = question.format(**placeholders)\n   512→            except KeyError as e:\n   513→                # If placeholder is missing, return template with unfilled placeholders\n   514→                # This is acceptable - AI can fill them contextually\n   515→                pass\n   516→\n   517→        return question\n   518→\n   519→    def generate_question_batch(\n   520→        self,\n   521→        approach: InquiryApproach,\n   522→        state: UserState,\n   523→        context: str,\n   524→        directness: str = \"balanced\",\n   525→        abstraction: str = \"mixed\",\n   526→        count: int = 3,\n   527→    ) -> QuestionBatch:\n   528→        \"\"\"Generate a batch of questions for a given state and approach.\n   529→\n   530→        Args:\n   531→            approach: The inquiry approach to use\n   532→            state: The detected user state\n   533→            context: Current conversation context\n   534→            directness: Profile directness setting\n   535→            abstraction: Profile abstraction preference\n   536→            count: Number of questions to generate\n   537→\n   538→        Returns:\n   539→            QuestionBatch with adapted questions\n   540→        \"\"\"\n   541→        templates = self.get_templates_for_approach(approach)\n   542→\n   543→        # Select diverse templates (different categories)\n   544→        selected_templates: list[QuestionTemplate] = []\n   545→        categories_used: set[str] = set()\n   546→\n   547→        for template in templates:\n   548→            if template.category not in categories_used:\n   549→                selected_templates.append(template)\n   550→                categories_used.add(template.category)\n   551→                if len(selected_templates) >= count:\n   552→                    break\n   553→\n   554→        # If we don't have enough unique categories, add more from any category\n   555→        if len(selected_templates) < count:\n   556→            for template in templates:\n   557→                if template not in selected_templates:\n   558→                    selected_templates.append(template)\n   559→                    if len(selected_templates) >= count:\n   560→                        break\n   561→\n   562→        # Adapt templates to profile settings\n   563→        questions = [\n   564→            self.adapt_template(template, directness=directness)\n   565→            for template in selected_templates\n   566→        ]\n   567→\n   568→        adaptations = [f\"directness={directness}\"]\n   569→        if abstraction != \"mixed\":\n   570→            adaptations.append(f\"abstraction={abstraction}\")\n   571→\n   572→        return QuestionBatch(\n   573→            approach=approach,\n   574→            state=state,\n   575→            questions=questions,\n   576→            context=context,\n   577→            profile_adaptations_applied=adaptations,\n   578→        )\n   579→\n   580→    def get_approach_description(self, approach: InquiryApproach) -> str:\n   581→        \"\"\"Get a description of an inquiry approach.\n   582→\n   583→        Args:\n   584→            approach: The inquiry approach\n   585→\n   586→        Returns:\n   587→            Description string for system prompts\n   588→        \"\"\"\n   589→        from ies_backend.schemas.question_engine import APPROACH_DESCRIPTIONS\n   590→\n   591→        return APPROACH_DESCRIPTIONS.get(\n   592→            approach, \"No description available for this approach.\"\n   593→        )\n   594→\n   595→    def get_all_approaches(self) -> list[InquiryApproach]:\n   596→        \"\"\"Get list of all inquiry approaches that have templates.\n   597→\n   598→        Returns:\n   599→            List of InquiryApproach values with templates\n   600→        \"\"\"\n   601→        approaches = {t.approach for t in self._templates}\n   602→        return sorted(approaches, key=lambda a: a.value)\n   603→\n   604→    def get_categories_for_approach(self, approach: InquiryApproach) -> list[str]:\n   605→        \"\"\"Get all categories available for an approach.\n   606→\n   607→        Args:\n   608→            approach: The inquiry approach\n   609→\n   610→        Returns:\n   611→            List of category names\n   612→        \"\"\"\n   613→        categories = {\n   614→            t.category for t in self._templates if t.approach == approach\n   615→        }\n   616→        return sorted(categories)\n   617→\n   618→    def get_template_count(self, approach: InquiryApproach | None = None) -> int:\n   619→        \"\"\"Get count of templates, optionally filtered by approach.\n   620→\n   621→        Args:\n   622→            approach: Optional approach to filter by\n   623→\n   624→        Returns:\n   625→            Number of templates\n   626→        \"\"\"\n   627→        if approach:\n   628→            return len([t for t in self._templates if t.approach == approach])\n   629→        return len(self._templates)\n   630→\n   631→\n   632→# Singleton instance\n   633→question_templates_service = QuestionTemplatesService()\n   634→"
  }
]

---

### Assistant
> 12/1/2025, 2:44:44 PM

[
  {
    "type": "text",
    "text": "Perfect! Now let me verify the service works correctly by running a quick test:"
  }
]

---

### Assistant
> 12/1/2025, 2:44:49 PM

[
  {
    "type": "tool_use",
    "id": "toolu_018AmT9XTe2Ccj6muVMoRsZw",
    "name": "Bash",
    "input": {
      "command": "cd /home/chris/dev/projects/codex/brain_explore/ies-backend && python3 -c \"\nfrom src.ies_backend.services.question_templates_service import question_templates_service\nfrom src.ies_backend.schemas.question_engine import InquiryApproach, UserState\n\n# Test template counts\nprint('Template Statistics:')\nprint(f'Total templates: {question_templates_service.get_template_count()}')\nprint()\n\nfor approach in InquiryApproach:\n    count = question_templates_service.get_template_count(approach)\n    if count > 0:\n        categories = question_templates_service.get_categories_for_approach(approach)\n        print(f'{approach.value}: {count} templates across {len(categories)} categories')\n        print(f'  Categories: {', '.join(categories)}')\n        print()\n\n# Test generating a question batch\nprint('Example Question Batch (Solution-Focused, Gentle):')\nbatch = question_templates_service.generate_question_batch(\n    approach=InquiryApproach.SOLUTION_FOCUSED,\n    state=UserState.STUCK,\n    context='User feels stuck in problem',\n    directness='gentle',\n    count=3\n)\nfor i, q in enumerate(batch.questions, 1):\n    print(f'{i}. {q}')\n\"",
      "description": "Test question templates service"
    }
  }
]

---

### User
> 12/1/2025, 2:44:50 PM

[
  {
    "type": "tool_result",
    "content": "Exit code 1\n  File \"<string>\", line 15\n    print(f'  Categories: {', '.join(categories)}')\n                            ^\nSyntaxError: f-string: expecting '}'",
    "is_error": true,
    "tool_use_id": "toolu_018AmT9XTe2Ccj6muVMoRsZw"
  }
]

---

### Assistant
> 12/1/2025, 2:44:53 PM

[
  {
    "type": "text",
    "text": "Let me fix the f-string syntax:"
  }
]

---

### Assistant
> 12/1/2025, 2:44:56 PM

[
  {
    "type": "tool_use",
    "id": "toolu_01JNR7G7vWEoi5oLr4mB7LEu",
    "name": "Bash",
    "input": {
      "command": "cd /home/chris/dev/projects/codex/brain_explore/ies-backend && python3 -c \"\nfrom src.ies_backend.services.question_templates_service import question_templates_service\nfrom src.ies_backend.schemas.question_engine import InquiryApproach, UserState\n\n# Test template counts\nprint('Template Statistics:')\nprint(f'Total templates: {question_templates_service.get_template_count()}')\nprint()\n\nfor approach in InquiryApproach:\n    count = question_templates_service.get_template_count(approach)\n    if count > 0:\n        categories = question_templates_service.get_categories_for_approach(approach)\n        cats_str = ', '.join(categories)\n        print(f'{approach.value}: {count} templates across {len(categories)} categories')\n        print(f'  Categories: {cats_str}')\n        print()\n\n# Test generating a question batch\nprint('Example Question Batch (Solution-Focused, Gentle):')\nbatch = question_templates_service.generate_question_batch(\n    approach=InquiryApproach.SOLUTION_FOCUSED,\n    state=UserState.STUCK,\n    context='User feels stuck in problem',\n    directness='gentle',\n    count=3\n)\nfor i, q in enumerate(batch.questions, 1):\n    print(f'{i}. {q}')\n\"",
      "description": "Test question templates service (fixed syntax)"
    }
  }
]

---

### User
> 12/1/2025, 2:44:58 PM

[
  {
    "tool_use_id": "toolu_01JNR7G7vWEoi5oLr4mB7LEu",
    "type": "tool_result",
    "content": "Template Statistics:\nTotal templates: 30\n\nsocratic: 6 templates across 5 categories\n  Categories: assumptions, clarifying, evidence, implications, reasoning\n\nsolution_focused: 6 templates across 5 categories\n  Categories: coping, exceptions, opening, resources, scaling\n\nphenomenological: 6 templates across 6 categories\n  Categories: checking, deepening, grounding, naming, sensation, welcoming\n\nsystems: 6 templates across 6 categories\n  Categories: boundaries, connections, delays, emergence, feedback, leverage\n\nmetacognitive: 6 templates across 6 categories\n  Categories: assumptions, learning, monitoring, perspective, reflection, strategy\n\nExample Question Batch (Solution-Focused, Gentle):\n1. Imagine this gets better - what might change?\n2. Are there times when things feel a little easier?\n3. If you had to guess, where might you be on a 1-10 scale toward {goal}?",
    "is_error": false
  }
]

---

### Assistant
> 12/1/2025, 2:45:01 PM

[
  {
    "type": "text",
    "text": "Excellent! Let me also test the template adaptation with placeholders:"
  }
]

---

### Assistant
> 12/1/2025, 2:45:06 PM

[
  {
    "type": "tool_use",
    "id": "toolu_01TLFPj7r2Jan3sSZt92pzax",
    "name": "Bash",
    "input": {
      "command": "cd /home/chris/dev/projects/codex/brain_explore/ies-backend && python3 -c \"\nfrom src.ies_backend.services.question_templates_service import question_templates_service\nfrom src.ies_backend.schemas.question_engine import InquiryApproach\n\n# Test adapting templates with placeholders\nprint('Testing Template Adaptation with Placeholders:')\nprint()\n\n# Socratic - clarifying\ntemplates = question_templates_service.get_templates_for_approach(\n    InquiryApproach.SOCRATIC, \n    category='clarifying'\n)\ntemplate = templates[0]\n\nprint(f'Template: {template.template}')\nprint(f'Source: {template.source}')\nprint()\n\nprint('Adapted versions:')\nfor directness in ['direct', 'balanced', 'gentle']:\n    adapted = question_templates_service.adapt_template(\n        template,\n        directness=directness,\n        placeholders={'concept': 'therapeutic alliance'}\n    )\n    print(f'  {directness}: {adapted}')\n\nprint()\nprint('Phenomenological - body awareness:')\npheno_templates = question_templates_service.get_templates_for_approach(\n    InquiryApproach.PHENOMENOLOGICAL,\n    category='sensation'\n)\ntemplate = pheno_templates[0]\n\nfor directness in ['direct', 'balanced', 'gentle']:\n    adapted = question_templates_service.adapt_template(\n        template,\n        directness=directness,\n        placeholders={'emotion': 'anxiety'}\n    )\n    print(f'  {directness}: {adapted}')\n\"",
      "description": "Test template adaptation with placeholders"
    }
  }
]

---

### User
> 12/1/2025, 2:45:08 PM

[
  {
    "tool_use_id": "toolu_01TLFPj7r2Jan3sSZt92pzax",
    "type": "tool_result",
    "content": "Testing Template Adaptation with Placeholders:\n\nTemplate: What do you mean when you say '{concept}'?\nSource: Paul & Elder (2006) - The Art of Socratic Questioning\n\nAdapted versions:\n  direct: Define what you mean by 'therapeutic alliance'.\n  balanced: What do you mean when you say 'therapeutic alliance'?\n  gentle: I'm curious what 'therapeutic alliance' means to you - could you say more?\n\nPhenomenological - body awareness:\n  direct: Where is anxiety in your body?\n  balanced: Where in your body do you feel anxiety?\n  gentle: If you scan your body, where might anxiety be showing up?",
    "is_error": false
  }
]

---

### Assistant
> 12/1/2025, 2:45:12 PM

[
  {
    "type": "text",
    "text": "Perfect! Let me verify the service integrates correctly with the existing schema imports:"
  }
]

---

### Assistant
> 12/1/2025, 2:45:15 PM

[
  {
    "type": "tool_use",
    "id": "toolu_01CHMq8CaFJ3NRcsf78t22ry",
    "name": "Bash",
    "input": {
      "command": "cd /home/chris/dev/projects/codex/brain_explore/ies-backend && python3 -c \"\nfrom src.ies_backend.services.question_templates_service import question_templates_service\nfrom src.ies_backend.schemas.question_engine import InquiryApproach, UserState\n\n# Test getting approach descriptions\nprint('Approach Descriptions:')\nprint()\nfor approach in [InquiryApproach.SOCRATIC, InquiryApproach.PHENOMENOLOGICAL, InquiryApproach.SYSTEMS]:\n    desc = question_templates_service.get_approach_description(approach)\n    print(f'{approach.value}:')\n    print(f'  {desc}')\n    print()\n\n# Test all approaches available\nprint('All approaches with templates:')\napproaches = question_templates_service.get_all_approaches()\nfor approach in approaches:\n    print(f'  - {approach.value}')\n\"",
      "description": "Test approach descriptions and metadata"
    }
  }
]

---

### User
> 12/1/2025, 2:45:17 PM

[
  {
    "tool_use_id": "toolu_01CHMq8CaFJ3NRcsf78t22ry",
    "type": "tool_result",
    "content": "Approach Descriptions:\n\nsocratic:\n  Socratic inquiry uses clarifying questions to surface assumptions,\ntest logical consistency, and deepen understanding. Ask 'what do you mean by...',\n'what would have to be true for...', 'how does X relate to Y'.\n\nphenomenological:\n  Phenomenological/Focusing approach attends to\nfelt sense and body-based knowing. Ask 'what do you notice in your body when you say that?',\n'can you stay with that feeling?', 'what word or image fits that sensation?'.\n\nsystems:\n  Systems thinking looks at connections, patterns, and emergence.\nAsk about relationships between parts, feedback loops, unintended consequences,\nand how changes in one area affect others.\n\nAll approaches with templates:\n  - metacognitive\n  - phenomenological\n  - socratic\n  - solution_focused\n  - systems",
    "is_error": false
  }
]

---

### Assistant
> 12/1/2025, 2:45:21 PM

[
  {
    "type": "text",
    "text": "Excellent! The service is working perfectly. Let me create a summary document showing the template breakdown:"
  }
]

---

### Assistant
> 12/1/2025, 2:45:26 PM

[
  {
    "type": "tool_use",
    "id": "toolu_01HbkzYoQkvfQ7bwYrzsXgzo",
    "name": "Bash",
    "input": {
      "command": "cd /home/chris/dev/projects/codex/brain_explore/ies-backend && python3 -c \"\nfrom src.ies_backend.services.question_templates_service import question_templates_service\nfrom src.ies_backend.schemas.question_engine import InquiryApproach\n\nprint('=' * 80)\nprint('QUESTION TEMPLATES SERVICE - COMPLETE INVENTORY')\nprint('=' * 80)\nprint()\n\nfor approach in question_templates_service.get_all_approaches():\n    templates = question_templates_service.get_templates_for_approach(approach)\n    categories = question_templates_service.get_categories_for_approach(approach)\n    \n    print(f'{approach.value.upper()}')\n    print('-' * 80)\n    print(f'Total: {len(templates)} templates across {len(categories)} categories')\n    print()\n    \n    # Group by category\n    for category in sorted(categories):\n        cat_templates = [t for t in templates if t.category == category]\n        print(f'  {category.upper()} ({len(cat_templates)} templates):')\n        for template in cat_templates:\n            # Show the balanced version\n            balanced = template.directness_variants.get('balanced', template.template)\n            print(f'    - {balanced}')\n            if template.source:\n                print(f'      Source: {template.source}')\n        print()\n    print()\n\"",
      "description": "Generate complete template inventory"
    }
  }
]

---

### User
> 12/1/2025, 2:45:27 PM

[
  {
    "tool_use_id": "toolu_01HbkzYoQkvfQ7bwYrzsXgzo",
    "type": "tool_result",
    "content": "================================================================================\nQUESTION TEMPLATES SERVICE - COMPLETE INVENTORY\n================================================================================\n\nMETACOGNITIVE\n--------------------------------------------------------------------------------\nTotal: 6 templates across 6 categories\n\n  ASSUMPTIONS (1 templates):\n    - What assumptions are you making about {situation}?\n      Source: Schraw & Moshman (1995) - Metacognitive theories\n\n  LEARNING (1 templates):\n    - What are you learning about how you think through {domain}?\n      Source: Schraw & Moshman (1995) - Metacognitive theories\n\n  MONITORING (1 templates):\n    - How confident are you in {conclusion}?\n      Source: Schraw & Moshman (1995) - Metacognitive theories\n\n  PERSPECTIVE (1 templates):\n    - What would you tell a friend facing this situation?\n      Source: Cognitive therapy tradition - self-distancing technique\n\n  REFLECTION (1 templates):\n    - How are you approaching this problem?\n      Source: Flavell (1979) - Metacognition and cognitive monitoring\n\n  STRATEGY (1 templates):\n    - Is this strategy working, or should you try something different?\n      Source: Flavell (1979) - Metacognition and cognitive monitoring\n\n\nPHENOMENOLOGICAL\n--------------------------------------------------------------------------------\nTotal: 6 templates across 6 categories\n\n  CHECKING (1 templates):\n    - Does {word} feel right, or is there something more accurate?\n      Source: Gendlin (1982) - Focusing\n\n  DEEPENING (1 templates):\n    - Can you stay with that feeling and see what it wants to say?\n      Source: Gendlin (1982) - Focusing\n\n  GROUNDING (1 templates):\n    - What do you notice in your body as you say that?\n      Source: Gendlin (1982) - Focusing\n\n  NAMING (1 templates):\n    - What word or image captures the quality of {sensation}?\n      Source: Gendlin (1982) - Focusing\n\n  SENSATION (1 templates):\n    - Where in your body do you feel {emotion}?\n      Source: Gendlin (1982) - Focusing\n\n  WELCOMING (1 templates):\n    - Can you say hello to {feeling} and let it know you're here with it?\n      Source: Cornell (2013) - The Radical Acceptance of Everything\n\n\nSOCRATIC\n--------------------------------------------------------------------------------\nTotal: 6 templates across 5 categories\n\n  ASSUMPTIONS (1 templates):\n    - What are you assuming when you say {statement}?\n      Source: Paul & Elder (2006) - The Art of Socratic Questioning\n\n  CLARIFYING (2 templates):\n    - What do you mean when you say '{concept}'?\n      Source: Paul & Elder (2006) - The Art of Socratic Questioning\n    - Can you give me an example of {concept}?\n      Source: Paul & Elder (2006) - The Art of Socratic Questioning\n\n  EVIDENCE (1 templates):\n    - What leads you to believe {claim}?\n      Source: Paul & Elder (2006) - The Art of Socratic Questioning\n\n  IMPLICATIONS (1 templates):\n    - If {statement} is true, what else would have to be true?\n      Source: Paul & Elder (2006) - The Art of Socratic Questioning\n\n  REASONING (1 templates):\n    - How does {concept_a} relate to {concept_b}?\n      Source: Paul & Elder (2006) - The Art of Socratic Questioning\n\n\nSOLUTION_FOCUSED\n--------------------------------------------------------------------------------\nTotal: 6 templates across 5 categories\n\n  COPING (1 templates):\n    - How have you managed to keep things from getting worse?\n      Source: De Jong & Berg (2013) - Interviewing for Solutions\n\n  EXCEPTIONS (1 templates):\n    - When is this problem less severe or absent?\n      Source: De Jong & Berg (2013) - Interviewing for Solutions\n\n  OPENING (1 templates):\n    - What would be different if this problem was solved?\n      Source: De Jong & Berg (2013) - Interviewing for Solutions\n\n  RESOURCES (1 templates):\n    - What resources or strengths have you used in similar situations?\n      Source: De Jong & Berg (2013) - Interviewing for Solutions\n\n  SCALING (2 templates):\n    - On a scale of 1-10, where 10 is {goal} fully achieved, where are you?\n      Source: De Jong & Berg (2013) - Interviewing for Solutions\n    - What would one point higher on the scale look like?\n      Source: De Jong & Berg (2013) - Interviewing for Solutions\n\n\nSYSTEMS\n--------------------------------------------------------------------------------\nTotal: 6 templates across 6 categories\n\n  BOUNDARIES (1 templates):\n    - What are you including in {system} and what are you leaving out?\n      Source: Meadows (2008) - Thinking in Systems\n\n  CONNECTIONS (1 templates):\n    - How does changing {element_a} affect {element_b}?\n      Source: Meadows (2008) - Thinking in Systems\n\n  DELAYS (1 templates):\n    - What delays exist between {action} and {outcome}?\n      Source: Senge (1990) - The Fifth Discipline\n\n  EMERGENCE (1 templates):\n    - What patterns emerge when {elements} interact over time?\n      Source: Meadows (2008) - Thinking in Systems\n\n  FEEDBACK (1 templates):\n    - What happens when {action} creates {result}, which then influences {action}?\n      Source: Meadows (2008) - Thinking in Systems\n\n  LEVERAGE (1 templates):\n    - Where could a small change create a large effect in {system}?\n      Source: Meadows (2008) - Thinking in Systems",
    "is_error": false
  }
]

---

### Assistant
> 12/1/2025, 2:45:51 PM

[
  {
    "type": "text",
    "text": "Perfect! The service is complete and working. Let me create a quick summary:\n\n## Question Templates Service - Complete\n\nI've successfully created a comprehensive **Question Templates Service** for the IES backend at:\n\n**File:** `/home/chris/dev/projects/codex/brain_explore/ies-backend/src/ies_backend/services/question_templates_service.py`\n\n### Key Features\n\n**1. Research-Backed Templates (30 total)**\n- **Socratic (6)**: From Paul & Elder (2006) \"The Art of Socratic Questioning\"\n  - Categories: clarifying, assumptions, reasoning, implications, evidence\n  \n- **Solution-Focused (6)**: From De Jong & Berg (2013) \"Interviewing for Solutions\"\n  - Categories: opening, exceptions, scaling, coping, resources\n  \n- **Phenomenological (6)**: From Gendlin (1982) \"Focusing\" and Cornell (2013)\n  - Categories: grounding, deepening, naming, welcoming, checking, sensation\n  \n- **Systems (6)**: From Meadows (2008) \"Thinking in Systems\" and Senge (1990)\n  - Categories: connections, feedback, emergence, leverage, boundaries, delays\n  \n- **Metacognitive (6)**: From Flavell (1979) and Schraw & Moshman (1995)\n  - Categories: reflection, assumptions, perspective, monitoring, strategy, learning\n\n**2. Profile Adaptations**\nEach template has 3 directness variants:\n- **Direct**: Concise, imperative (\"Define what you mean by X\")\n- **Balanced**: Standard question form (\"What do you mean by X?\")\n- **Gentle**: Softer, more tentative (\"I'm curious what X means to you...\")\n\n**3. Service Methods**\n\n```python\n# Get templates for an approach\nget_templates_for_approach(approach, category=None)\n\n# Find template by criteria\nget_template_by_criteria(approach, category, context)\n\n# Adapt template to profile\nadapt_template(template, directness=\"balanced\", placeholders={})\n\n# Generate question batch\ngenerate_question_batch(approach, state, context, directness, abstraction, count)\n\n# Metadata\nget_approach_description(approach)\nget_all_approaches()\nget_categories_for_approach(approach)\nget_template_count(approach=None)\n```\n\n**4. Template Features**\n- `source`: Academic citation\n- `when_to_use`: Context guidance\n- `pace_considerations`: Timing/energy notes\n- `directness_variants`: 3 phrasings\n- Placeholder support: `{concept}`, `{emotion}`, `{system}`, etc.\n\n**5. Example Usage**\n\n```python\nfrom ies_backend.services.question_templates_service import question_templates_service\nfrom ies_backend.schemas.question_engine import InquiryApproach, UserState\n\n# Generate adapted questions\nbatch = question_templates_service.generate_question_batch(\n    approach=InquiryApproach.SOLUTION_FOCUSED,\n    state=UserState.STUCK,\n    context=\"User feels stuck\",\n    directness=\"gentle\",\n    count=3\n)\n\n# Results:\n# 1. Imagine this gets better - what might change?\n# 2. Are there times when things feel a little easier?\n# 3. If you had to guess, where might you be on a 1-10 scale...\n```\n\nThe service is fully integrated with the existing schema system and ready for Phase 3 of the IES implementation. All templates include proper academic attribution and are organized for easy retrieval and adaptation based on user state and profile preferences."
  }
]

