# 3.3 Notebook Schema

**Purpose:** The IES notebook structure defines the organizational hierarchy for personal knowledge management in SiYuan, with a 9-folder system that supports ADHD-friendly capture, structured thinking, and knowledge formalization workflows.

## What is a Notebook in IES?

A notebook in IES is:
- **Workspace:** Top-level container for all notes (SiYuan's primary organizational unit)
- **Hierarchical:** 9 top-level folders with specific purposes and subfolder structures
- **ADHD-Optimized:** Designed for low-friction capture, mood-appropriate navigation, and non-judgmental knowledge lifecycles
- **Domain-Agnostic:** User-configurable notebook names (not hardcoded to any specific domain)

## Nine-Folder Structure

From `.worktrees/siyuan/ies/plugin/src/utils/siyuan-structure.ts` (lines 53-97):

```typescript
const STRUCTURE_FOLDERS = [
    // Daily quick captures
    { path: 'Daily', title: 'Daily' },

    // Seedlings - atomic ideas
    { path: 'Seedlings', title: 'Seedlings' },
    { path: 'Seedlings/Questions', title: 'Seedlings – Questions' },
    { path: 'Seedlings/Observations', title: 'Seedlings – Observations' },
    { path: 'Seedlings/Moments', title: 'Seedlings – Moments' },
    { path: 'Seedlings/Schemas', title: 'Seedlings – Schemas' },
    { path: 'Seedlings/Contradictions', title: 'Seedlings – Contradictions' },
    { path: 'Seedlings/What_Ifs', title: 'Seedlings – What Ifs' },
    { path: 'Seedlings/Insights', title: 'Seedlings – Insights' },

    // Sessions by thinking mode
    { path: 'Sessions', title: 'Sessions' },
    { path: 'Sessions/Learning', title: 'Learning Sessions' },
    { path: 'Sessions/Articulating', title: 'Articulating Sessions' },
    { path: 'Sessions/Planning', title: 'Planning Sessions' },
    { path: 'Sessions/Ideating', title: 'Ideating Sessions' },
    { path: 'Sessions/Reflecting', title: 'Reflecting Sessions' },

    // Flow Maps - visual exploration
    { path: 'Flow_Maps', title: 'Flow Maps' },

    // Concepts - canonical knowledge
    { path: 'Concepts', title: 'Concepts' },

    // Promoted insights
    { path: 'Insights', title: 'Insights' },

    // ADHD anchor questions
    { path: 'Favorite_Problems', title: 'Favorite Problems' },

    // Active work
    { path: 'Projects', title: 'Projects' },

    // Retired material
    { path: 'Archive', title: 'Archive' },

    // System layer
    { path: 'System', title: 'System' },
    { path: 'System/Templates', title: 'System – Templates' },
    { path: 'System/Example_Notes', title: 'System – Example Notes' },
];
```

**Total:** 27 folders (9 top-level + 18 subfolders)

## Folder Purposes and Lifecycles

### 1. `/Daily/` — Zero-Friction Capture

**Purpose:** Daily logs for low-friction quick capture without derailing current task

**Block Type:** `log_entry`

**Lifecycle:**
- **Capture:** Quick thoughts, highlights, sparks land here automatically
- **Process:** User reviews captures, promotes to Seedlings or Archives

**Structure:**
```
/Daily/
  ├── 2025/
  │   ├── 12/
  │   │   ├── 2025-12-05
  │   │   ├── 2025-12-06
  │   │   └── ...
```

**Auto-created by:** `createSparkWithBackend()` appends to daily log organized by date

### 2. `/Seedlings/` — Atomic Ideas (7 Subcategories)

**Purpose:** Categorized atomic ideas organized by 7 idea types

**Block Type:** `seed`

**Seven Subfolders:**

| Subfolder | Purpose | Idea Type | Example |
|-----------|---------|-----------|---------|
| `/Questions` | Questions worth exploring | `question` | "Does shame block EF access?" |
| `/Observations` | Noticed patterns or facts | `observation` | "I notice energy drops after phone use" |
| `/Moments` | Emotionally significant experiences | `moment` | "Felt sudden clarity during walk" |
| `/Schemas` | Mental models or frameworks | `schema` | "Two-status system (AI vs user)" |
| `/Contradictions` | Tensions or paradoxes | `contradiction` | "Acceptance feels like resignation but isn't" |
| `/What_Ifs` | Hypothetical explorations | `what_if` | "What if constraint enables meaning?" |
| `/Insights` | Raw "aha" moments | `insight` | "Shame prevents metabolization" |

**Note:** `Seedlings/Insights` = raw, unvalidated. `/Insights/` (root) = promoted, validated.

**Lifecycle:**
- **Captured:** Seed with `idea_type` set, `clarity: 'fuzzy'`
- **Exploring:** User edits, links, `clarity` → `partial` → `clear`
- **Anchored:** Promoted to `/Insights/` or `/Concepts/`

### 3. `/Sessions/` — Structured Thinking (5 Mode Folders)

**Purpose:** Session documents organized by thinking mode

**Block Type:** `shaping`

**Five Mode Subfolders:**

| Subfolder | Purpose | Template | Question Classes Used |
|-----------|---------|----------|----------------------|
| `/Learning` | Understand how things work | `learning-mechanism-map` | Schema-Probe, Causal, Anchor |
| `/Articulating` | Clarify vague intuitions | `articulating-clarify-intuition` | Phenomenological, Boundary |
| `/Planning` | Structure future action | TBD | Dimensional, Causal |
| `/Ideating` | Generate new possibilities | TBD | Counterfactual, Perspective-Shift |
| `/Reflecting` | Integrate and synthesize | TBD | Meta-Cognitive, Reflective-Synthesis |

**Document Naming:** `{YYYY-MM-DD-HHMM}-{topic}.md`

**Created by:** `createSessionDocument()` in `siyuan-structure.ts` (lines 794-984)

**Contents:**
- YAML frontmatter with `session_id`, `mode`, `template_id`, `question_classes_used`
- Section responses (if template-driven)
- Thinking dialogues (question-response exchanges)
- Full conversation transcript
- Session results (entities extracted, graph mapping, question types)

### 4. `/Flow_Maps/` — Visual Exploration

**Purpose:** Visual maps created during Flow mode exploration

**Block Type:** `map`

**Map Types:**
- `concept_cluster`: Related concepts grouped visually
- `timeline`: Chronological development of ideas
- `system`: System diagrams
- `schema`: Structural representations
- `perspective`: Different viewpoints on same topic

**Created by:** Flow mode sessions (export from Flow canvas to SiYuan document)

### 5. `/Concepts/` — Canonical Knowledge Graph Nodes

**Purpose:** Formalized concepts with relationships to other concepts

**Block Type:** `concept`

**Lifecycle:**
- **Draft:** Initial formalization from session extraction
- **Active:** Validated, connected to other concepts
- **Deprecated:** Superseded by refined concept

**Created by:** `createConceptDocument()` in `siyuan-structure.ts` (lines 1009-1106)

**Dual Save:** Both Neo4j (relationships) and SiYuan (editing)

**Contents:**
- Definition
- Aliases
- Relationships (to other concepts with evidence)
- Supporting quotes from source sessions
- Origin metadata (session ID)

### 6. `/Insights/` — Promoted/Validated Insights

**Purpose:** Insights that have been validated through exploration and reflection

**Block Type:** `seed` (promoted from Seedlings/Insights)

**Lifecycle:**
- **Seedlings/Insights** → raw "aha" moment
- **User validates** → promotes via `promoteToInsight()`
- **Moved to /Insights/** → `status: 'anchored'`

**Created by:** `promoteToInsight()` in `siyuan-structure.ts` (lines 616-673)

### 7. `/Favorite_Problems/` — ADHD Anchor Questions

**Purpose:** Stable navigation points for wandering minds (Feynman's "12 favorite problems" concept)

**Block Type:** Custom (not formalized in block schema yet)

**Purpose:** Questions that remain interesting over time, serve as entry points for exploration

**Examples:**
- "How does constraint enable meaning?"
- "What makes some difficult experiences transformative and others traumatic?"
- "How do systems create the conditions for emergence?"

**Design Rationale:** ADHD minds benefit from stable anchor points. Favorite Problems provide consistent entry into knowledge graph even when memory is fragmented.

### 8. `/Projects/` — Active Work

**Purpose:** Project-specific documentation with decision tracking

**Block Type:** `decision` (for decision logs)

**Structure (8-Page Template from IES Architecture Package):**
- README: Project overview
- Goals: Clear objectives
- Questions: Open questions to answer
- Plan: Implementation strategy
- Status: Current progress
- Decisions: Decision log with rationale
- Research: Background reading notes
- Maps: Visual maps
- Logs: Activity timeline

**Created by:** User manually or via project template

### 9. `/Archive/` — Retired Material

**Purpose:** Deprecated notes, superseded concepts, completed projects

**Lifecycle:**
- **Active document** → User archives via `archiveCapture()`
- **Moved to /Archive/** → `custom-status: 'archived'`, `custom-archived_at`, `custom-archive_reason`

**Created by:** `archiveCapture()` in `siyuan-structure.ts` (lines 679-719)

**Design Rationale:** Non-judgmental alternative to deletion. Material might be useful later.

### 10. `/System/` — Meta-Layer

**Purpose:** Templates, example notes, schemas, AI directives

**Subfolders:**
- `/System/Templates`: Markdown templates for each block type
- `/System/Example_Notes`: Reference implementations

**Contents:**
- Block schema specifications
- AI assistant directives
- Quick Capture schema
- Note templates (daily page, concept page, session, flow map, project)

**Design Rationale:** Provides canonical structure documentation accessible to both users and AI assistants.

## Folder Creation and Management

**Auto-Creation:**

The `ensureNotebookStructure()` function in `siyuan-structure.ts` (lines 280-285) creates all 27 folders on plugin load:

```typescript
export async function ensureNotebookStructure(): Promise<void> {
    const notebook = await resolveStructureNotebook();
    for (const folder of STRUCTURE_FOLDERS) {
        await ensureDocument(notebook.id, folder.path, folder.title);
    }
}
```

**Document Existence Check:**

`ensureDocument()` (lines 312-326) uses SQL to check if folder exists before creating:

```typescript
export async function ensureDocument(
    notebookId: string,
    path: string,
    title: string
): Promise<string> {
    const existingId = await getDocIdByPath(notebookId, path);
    if (existingId) {
        return existingId;
    }

    // Create the document
    const fullPath = `/${path}`;
    const docId = await createDocWithMd(notebookId, fullPath, `# ${title}\n\n`);
    return docId;
}
```

## Notebook Resolution (Domain-Agnostic)

IES supports user-configurable notebook names (not hardcoded to any specific domain).

**Default Notebook Names** (`siyuan-structure.ts` lines 30-36):

```typescript
const DEFAULT_NOTEBOOK_NAMES = [
    'IES',
    'Personal',
    'Knowledge',
    'Notes',
    'Intelligent Exploration System',
];
```

**Resolution Strategy:**
1. Check settings store for `preferredNotebooks` array
2. Fall back to localStorage `ies.preferredNotebooks`
3. Fall back to `DEFAULT_NOTEBOOK_NAMES`
4. Find first matching open notebook
5. If no match, use first open notebook

**Functions:**

- `getPreferredNotebookNames()` (lines 215-238): Retrieves user preferences
- `resolveStructureNotebook()` (lines 244-274): Finds matching notebook
- `setPreferredNotebooks(names)` (lines 1131-1144): Updates preferences

**Example Usage:**

```typescript
// User can customize notebook names for their domain
setPreferredNotebooks(['Research', 'Academic Notes', 'IES']);
```

## Folder Relationship Map

**Capture Flow:**
```
Quick Capture (phone/readest/web)
  ↓
/Daily/ (log_entry blocks)
  ↓
Process
  ↓
/Seedlings/{type}/ (seed blocks)
  ↓
Explore & Validate
  ↓
/Insights/ OR /Concepts/ (anchored knowledge)
```

**Session Flow:**
```
ForgeMode Session
  ↓
/Sessions/{mode}/ (shaping blocks)
  ↓
Extract Entities
  ↓
/Concepts/ (concept blocks)
```

**Flow Exploration:**
```
/Concepts/ OR /Insights/
  ↓
Flow Mode Exploration
  ↓
/Flow_Maps/ (map blocks)
```

## Implementation Files

**Folder Structure Definition:**
- `.worktrees/siyuan/ies/plugin/src/utils/siyuan-structure.ts` (lines 53-97)
  - `STRUCTURE_FOLDERS` array with all 27 folders
  - `ensureNotebookStructure()` creates folders on plugin load

**Mode Folder Mapping:**
- `MODE_FOLDER_MAP` (lines 102-108): Maps thinking modes to session subfolders

```typescript
const MODE_FOLDER_MAP: Record<string, string> = {
    learning: 'Sessions/Learning',
    articulating: 'Sessions/Articulating',
    planning: 'Sessions/Planning',
    ideating: 'Sessions/Ideating',
    reflecting: 'Sessions/Reflecting',
};
```

**Notebook Configuration:**
- `getPreferredNotebookNames()` (lines 215-238): User preferences
- `resolveStructureNotebook()` (lines 244-274): Notebook resolution
- `setPreferredNotebooks()` (lines 1131-1144): Update preferences

**Document Creation:**
- `ensureDocument()` (lines 312-326): Create folder if doesn't exist
- `getDocIdByPath()` (lines 292-307): SQL query to find existing documents

## References

**TypeScript Implementation:**
- `.worktrees/siyuan/ies/plugin/src/utils/siyuan-structure.ts` — Complete notebook structure implementation

**Design Documents:**
- `docs/IES_SiYuan_Architecture/README.md` — Reference architecture with 7-layer structure
- `docs/ARCHITECTURE-COMPARISON.md` — Design decisions for merged architecture
- `docs/plans/2025-12-05-siyuan-architecture-merge-design.md` — Merge strategy for 9-folder hierarchy
